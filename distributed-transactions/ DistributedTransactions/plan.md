
# # üî• A. Distributed Transactions: –æ—Ç 2PC –¥–æ Saga

## üß® –ë–æ–ª—å, –∫–æ—Ç–æ—Ä–∞—è –∑–∞–ø—É—Å–∫–∞–µ—Ç –≤–µ—Å—å —Ä–∞–∑–≥–æ–≤–æ—Ä

–ë–∏–∑–Ω–µ—Å –≥–æ–≤–æ—Ä–∏—Ç: ¬´–í–æ—Ç —Ç—É—Ç –Ω–∞–¥–æ —Å–¥–µ–ª–∞—Ç—å –æ–¥–Ω—É –æ–ø–µ—Ä–∞—Ü–∏—é, –∫–æ—Ç–æ—Ä–∞—è –∑–∞—Ç—Ä–∞–≥–∏–≤–∞–µ—Ç 3 –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–∞, –∏ —á—Ç–æ–±—ã –≤—Å—ë –±—ã–ª–æ –∞—Ç–æ–º–∞—Ä–Ω–æ¬ª.
–ò —Ç—ã —Å–∏–¥–∏—à—å, –≥—Ä—É—Å—Ç–Ω–æ —Å–º–æ—Ç—Ä–∏—à—å –Ω–∞ —ç—Ç–æ –¢–ó, –ø–æ–Ω–∏–º–∞—è:

* –Ω–µ—Ç –æ–¥–Ω–æ–π –±–∞–∑—ã
* –Ω–µ—Ç –æ–¥–Ω–æ–≥–æ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–æ–Ω–Ω–æ–≥–æ –º–µ–Ω–µ–¥–∂–µ—Ä–∞
* –Ω–µ—Ç shared lock manager
* –µ—Å—Ç—å –∫—É—á–∞ —Å–µ—Ä–≤–∏—Å–æ–≤, –∫–∞–∂–¥—ã–π —Å–æ —Å–≤–æ–µ–π –ë–î
* —Å–µ—Ç—å –Ω–µ –Ω–∞–¥—ë–∂–Ω–∞
* –∫–∞–∂–¥—ã–π —Å–µ—Ä–≤–∏—Å –∂–∏–≤—ë—Ç –≤ —Å–≤–æ—ë–º —Å–ª–æ–µ –∞–¥–∞

–ò –±–æ–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —Ç–∞–∫–∏–µ:

* –¥–µ–Ω—å–≥–∏ —Å–ø–∏—Å–∞–ª–∏—Å—å, –∞ –∑–∞–∫–∞–∑ –Ω–µ —Å–æ–∑–¥–∞–ª—Å—è
* –∑–∞–∫–∞–∑ —Å–æ–∑–¥–∞–ª—Å—è –¥–≤–∞–∂–¥—ã
* –æ–¥–Ω–æ –∏–∑ —Å–æ–±—ã—Ç–∏–π –ø–æ—Ç–µ—Ä—è–ª–æ—Å—å
* –¥–∞–Ω–Ω—ã–µ –≤ —Ä–∞–∑–Ω—ã—Ö —Å–µ—Ä–≤–∏—Å–∞—Ö –ø—Ä–æ—Ç–∏–≤–æ—Ä–µ—á–∞—Ç –¥—Ä—É–≥ –¥—Ä—É–≥—É

–ò –≤–æ—Ç –æ–Ω–æ ‚Äî **–Ω—É–∂–Ω–∞ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è, –Ω–æ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –Ω–µ—Ç**.

---

## üéØ –ß—Ç–æ —Ä–∞—Å—Å–∫–∞–∑–∞—Ç—å –≤ —ç—Ç–æ–π —á–∞—Å—Ç–∏ (–≤–µ—Ä—Ö–Ω–µ—É—Ä–æ–≤–Ω–µ–≤–æ)

### 1. –ü–æ—á–µ–º—É –∫–ª–∞—Å—Å–∏—á–µ—Å–∫–∞—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è ‚Äú–±–æ–ª—å—à–µ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç‚Äù –≤ –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–∞—Ö

* –Ω–µ—Ç –µ–¥–∏–Ω–æ–≥–æ ACID
* —Å–µ—Ç—å –Ω–µ–Ω–∞–¥—ë–∂–Ω–∞
* –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–æ—Ä –º–æ–∂–µ—Ç —É–º–µ—Ä–µ—Ç—å
* —Ä–∞—Å–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω—ã–π commit = –∫–æ—à–º–∞—Ä
* CAP –Ω–µ –ø–æ–∑–≤–æ–ª—è–µ—Ç ‚Äú–∫–∞–∫ –≤ –º–æ–Ω–æ–ª–∏—Ç–µ‚Äù

### 2. 2PC (Two-Phase Commit)

*–ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∫–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç –∏ –ø–æ—á–µ–º—É —ç—Ç–æ –±–æ–ª—å.*

* Coordinator ‚Üí prepare ‚Üí commit
* –µ—Å–ª–∏ –æ–¥–∏–Ω –∏–∑ —É–∑–ª–æ–≤ –∑–∞–≤–∏—Å–Ω–µ—Ç ‚Äî –≤—Å—è —Å–∏—Å—Ç–µ–º–∞ –≤–∏—Å–∏—Ç
* –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ –¥–æ–ª–≥–∏–µ
* –¥–µ–≥—Ä–∞–¥–∞—Ü–∏—è –≤—Å–µ–≥–æ —Å–µ—Ä–≤–∏—Å–∞
* single point of failure
* –ø–æ—á–µ–º—É –≤ —Ä–µ–∞–ª—å–Ω—ã—Ö –ø—Ä–æ–¥–∞—Ö 2PC –ø–æ—á—Ç–∏ –Ω–µ –ø—Ä–∏–º–µ–Ω—è—é—Ç

–°–º—ã—Å–ª –±–ª–æ–∫–∞: **2PC ‚Äî —Ç–µ–æ—Ä–µ—Ç–∏—á–µ—Å–∫–∏ –∫—Ä–∞—Å–∏–≤–æ, –ø—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏ –±–µ–∑–Ω–∞–¥—ë–∂–Ω–æ**.

### 3. Saga Pattern (–∫–∞—Å–∫–∞–¥ –∫–æ–º–ø–µ–Ω—Å–∏—Ä—É—é—â–∏—Ö –æ–ø–µ—Ä–∞—Ü–∏–π)

*–í–æ—Ç —Ä–µ–∞–ª—å–Ω–æ –ø—Ä–∏–º–µ–Ω–∏–º–∞—è –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞.*

* –∫–∞–∂–¥–∞—è ‚Äú—à–∞–≥-–æ–ø–µ—Ä–∞—Ü–∏—è‚Äù –∏–º–µ–µ—Ç ‚Äú–∫–æ–º–ø–µ–Ω—Å–∞—Ü–∏—é‚Äù
* –Ω–µ—Ç –≥–ª–æ–±–∞–ª—å–Ω—ã—Ö –±–ª–æ–∫–∏—Ä–æ–≤–æ–∫
* –Ω–µ—Ç coordinator deadlock
* —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è –ø—Ä–µ–≤—Ä–∞—â–∞–µ—Ç—Å—è –≤ workflow
* –ª–∏–±–æ –ø—Ä–æ—Ü–µ—Å—Å —É—Å–ø–µ—à–Ω–æ –∑–∞–≤–µ—Ä—à–∞–µ—Ç—Å—è
* –ª–∏–±–æ –º—ã –æ—Ç–∫–∞—Ç—ã–≤–∞–µ–º—Å—è –∫–æ–º–ø–µ–Ω—Å–∏—Ä—É—é—â–∏–º–∏ –¥–µ–π—Å—Ç–≤–∏—è–º–∏

–†–∞—Å—Å–∫–∞–∑—ã–≤–∞–µ–º:

* orchestration vs choreography
* –∫–∞–∫ –±–∏–∑–Ω–µ—Å-—Å—Ü–µ–Ω–∞—Ä–∏–π –ø—Ä–µ–≤—Ä–∞—â–∞–µ—Ç—Å—è –≤ —Å–∞–≥–∞ workflow
* –≥–¥–µ —Å–∞–≥–∏ –ø—Ä–æ–≤–∞–ª–∏–ª–∏—Å—å (–Ω–∏–∫–∞–∫–æ–≥–æ –≤–æ–ª—à–µ–±—Å—Ç–≤–∞)
* Temporal, Camunda, Conductor: –∑–∞—á–µ–º –æ–Ω–∏ –Ω—É–∂–Ω—ã
* –∫–∞–∫ –∂–∏—Ç—å —Å eventual consistency –≤–Ω—É—Ç—Ä–∏ —Å–∞–≥–∏

### 4. –ë–æ–ª–∏ —Å–∞–≥

* ‚Äú–∫–æ–º–ø–µ–Ω—Å–∞—Ü–∏—è‚Äù –Ω–µ –≤—Å–µ–≥–¥–∞ –≤–æ–∑–º–æ–∂–Ω–∞
* –ø–æ–±–æ—á–Ω—ã–µ —ç—Ñ—Ñ–µ–∫—Ç—ã –Ω–µ–ª—å–∑—è —Å—Ç–µ—Ä–µ—Ç—å
* –≤–Ω–µ—à–Ω–∏–µ API –Ω–µ–ª—å–∑—è –æ—Ç–∫–∞—Ç–∏—Ç—å
* —Å–ª–æ–∂–Ω–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å
* —Å–ª–æ–∂–Ω–æ –º–æ–Ω–∏—Ç–æ—Ä–∏—Ç—å
* —Ç—Ä–µ–±—É–µ—Ç—Å—è idempotency

---
