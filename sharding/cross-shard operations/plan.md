# üìò **–û–±–Ω–æ–≤–ª—ë–Ω–Ω—ã–π –ü–ª–∞–Ω: Cross-Shard –æ–ø–µ—Ä–∞—Ü–∏–∏ –∏ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏**

*(—É—Å–∏–ª–µ–Ω–Ω–∞—è –≤–µ—Ä—Å–∏—è –±–µ–∑ –ª–∏—à–Ω–∏—Ö –±–ª–æ–∫–æ–≤)*

---

# üß® 0. –ë–û–õ–¨ (–≤—Ö–æ–¥ —Å –ø—Ä–µ–¥—ã–¥—É—â–µ–≥–æ —Ä–∞–∑–¥–µ–ª–∞)

–°–≤—è–∑—ã–≤–∞—é—â–∞—è —Ñ—Ä–∞–∑–∞:

> –ú—ã –Ω–∞—É—á–∏–ª–∏—Å—å —à–∞—Ä–¥–∏—Ä–æ–≤–∞—Ç—å –¥–∞–Ω–Ω—ã–µ –∏ –¥–∞–∂–µ –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ –ø–µ—Ä–µ—Å—Ç—Ä–∞–∏–≤–∞—Ç—å —à–∞—Ä–¥—ã.
> –ù–æ —à–∞—Ä–¥–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–µ —Ä–µ—à–∞–µ—Ç –≤—Å–µ—Ö –ø—Ä–æ–±–ª–µ–º. –û–Ω–æ —Å–æ–∑–¥–∞—ë—Ç –Ω–æ–≤—ã–µ.
> –°–∞–º—É—é –≥–ª–∞–≤–Ω—É—é –∏–∑ –Ω–∏—Ö ‚Äî *cross-shard –æ–ø–µ—Ä–∞—Ü–∏–∏*.

–î–∞–ª–µ–µ ‚Äî —á—ë—Ç–∫–∞—è –±–æ–ª—å:

* –±–∏–∑–Ω–µ—Å-–æ–ø–µ—Ä–∞—Ü–∏–∏ –∂–∏–≤—É—Ç –≤ –æ–¥–Ω–æ–º –º–∏—Ä–µ
* –¥–∞–Ω–Ω—ã–µ –ø–æ—Å–ª–µ —à–∞—Ä–¥–∏—Ä–æ–≤–∞–Ω–∏—è –∂–∏–≤—É—Ç –≤ –¥—Ä—É–≥–æ–º
* –ª–æ–≥–∏–∫–∞ –ø—Ä–∏–∫–ª–∞–¥–Ω–æ–≥–æ —É—Ä–æ–≤–Ω—è –Ω–∞—á–∏–Ω–∞–µ—Ç –ª–æ–º–∞—Ç—å—Å—è
* latency —Ä–∞—Å—Ç—ë—Ç
* tail –≤–∑–ª–µ—Ç–∞–µ—Ç
* JOIN —É–º–∏—Ä–∞–µ—Ç
* —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ —Å—Ç–∞–Ω–æ–≤—è—Ç—Å—è –Ω–µ–≤–æ–∑–º–æ–∂–Ω—ã
* scatter-gather —Ä–∞—Å—Ç—ë—Ç –∫–∞–∫ —Ä–∞–∫

–ó–∞–¥–∞—á–∞: –ø–æ–≥—Ä—É–∑–∏—Ç—å —Å–ª—É—à–∞—Ç–µ–ª—è –≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç.

---

# üß® 1. –ü–æ—á–µ–º—É cross-shard –æ–ø–µ—Ä–∞—Ü–∏–∏ –Ω–µ–∏–∑–±–µ–∂–Ω—ã

–ù–∏–∫–∞–∫–æ–π —Ç–µ–æ—Ä–∏–∏, —Ç–æ–ª—å–∫–æ –∂–∏–∑–Ω–µ–Ω–Ω—ã–π –ø—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–π —Å–ø–∏—Å–æ–∫ —Å–∏—Ç—É–∞—Ü–∏–π:

### ‚úî –∫–æ–≥–¥–∞ —Å—É—â–Ω–æ—Å—Ç–∏ –æ–∫–∞–∑—ã–≤–∞—é—Ç—Å—è –Ω–∞ —Ä–∞–∑–Ω—ã—Ö —à–∞—Ä–¥–∞—Ö:

* –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–æ–∫—É–ø–∞–µ—Ç —É –ø—Ä–æ–¥–∞–≤—Ü–∞
* —á–∞—Ç –º–µ–∂–¥—É –¥–≤—É–º—è –ª—é–¥—å–º–∏
* –ø–ª–∞—Ç—ë–∂ ‚Üí –∑–∞–∫–∞–∑ ‚Üí —Å–∫–ª–∞–¥

### ‚úî –∫–æ–≥–¥–∞ –∑–∞–ø—Ä–æ—Å –Ω–µ —Å–æ–¥–µ—Ä–∂–∏—Ç shard key:

```
GET /orders?status=pending
```

### ‚úî –∫–æ–≥–¥–∞ –Ω—É–∂–µ–Ω —Ñ–∏–ª—å—Ç—Ä / –ø–æ–∏—Å–∫ –ø–æ –∞—Ç—Ä–∏–±—É—Ç–∞–º:

* –≤–æ–∑—Ä–∞—Å—Ç
* –∫–∞—Ç–µ–≥–æ—Ä–∏—è
* —Ä–µ–π—Ç–∏–Ω–≥

### ‚úî –∫–æ–≥–¥–∞ –Ω—É–∂–Ω–∞ –∞–≥—Ä–µ–≥–∞—Ü–∏—è:

* –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–∫–∞–∑–æ–≤ –∑–∞ –Ω–µ–¥–µ–ª—é
* —Ç–æ–ø —Ç–æ–≤–∞—Ä–æ–≤
* —Å—É–º–º–∞ –±–∞–ª–∞–Ω—Å–æ–≤

### ‚úî –∫–æ–≥–¥–∞ –Ω—É–∂–µ–Ω global ordering:

* ‚Äú–ø–æ—Å–ª–µ–¥–Ω–∏–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏‚Äù
* ‚Äú–ø–æ—Å–ª–µ–¥–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è‚Äù

### ‚úî –∫–æ–≥–¥–∞ –Ω—É–∂–µ–Ω join:

* –∑–∞–∫–∞–∑ + –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
* –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π + –¥–∞–Ω–Ω—ã–µ –∞–≤—Ç–æ—Ä–∞

**–í—Å–µ —ç—Ç–∏ —Å—Ü–µ–Ω–∞—Ä–∏–∏ –ø—Ä–æ–¥–æ–ª–∂–∞—é—Ç —Å—É—â–µ—Å—Ç–≤–æ–≤–∞—Ç—å –¥–∞–∂–µ –ø–æ—Å–ª–µ —à–∞—Ä–¥–∏—Ä–æ–≤–∞–Ω–∏—è.**

---

# üß© 2. –¢–∏–ø—ã cross-shard –æ–ø–µ—Ä–∞—Ü–∏–π (—Å—Ç—Ä—É–∫—Ç—É—Ä–∞)

–°—Ç—Ä–æ–≥–æ –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º:

### 2.1. Cross-Shard JOIN

–°–≤—è–∑–∞—Ç—å –¥–∞–Ω–Ω—ã–µ –∏–∑ —Ä–∞–∑–Ω—ã—Ö —à–∞—Ä–¥–æ–≤.

### 2.2. Cross-Shard Aggregation

–ì–ª–æ–±–∞–ª—å–Ω—ã–µ COUNT, SUM, GROUP BY.

### 2.3. Cross-Shard Filtering / Search

–õ—é–±–æ–π –∑–∞–ø—Ä–æ—Å –±–µ–∑ shard key ‚Üí fan-out.

### 2.4. Cross-Shard Transactions

–ê—Ç–æ–º–∞—Ä–Ω–æ—Å—Ç—å –æ–ø–µ—Ä–∞—Ü–∏–π –º–µ–∂–¥—É —à–∞—Ä–¥–∞–º–∏.

### 2.5. Cross-Shard Ordering

–°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏ –ø–æ timestamp, score, rank.

### 2.6. Scatter-Gather Queries

–®–∏—Ä–æ–∫–∏–π –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã–π –∑–∞–ø—Ä–æ—Å ‚Üí merge.

–¶–µ–ª—å: —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ–±–ª–µ–º—É, —á—Ç–æ–±—ã –æ–Ω–∞ –Ω–µ –∫–∞–∑–∞–ª–∞—Å—å –º–∞–≥–∏–µ–π.

---

# üõ† 3. –ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏

*(—Å–∞–º—ã–π –±–æ–ª—å—à–æ–π –±–ª–æ–∫)*

---

## üü¶ 3.1. Data Locality (–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π shard key)

–ü—Ä–µ–¥—ã–¥—É—â–∏–π —Ä–∞–∑–¥–µ–ª –±—ã–ª –ø—Ä–æ —ç—Ç–æ,
–∑–¥–µ—Å—å —Ç–æ–ª—å–∫–æ –∫–æ—Ä–æ—Ç–∫–æ–µ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ:

> 90% cross-shard –æ–ø–µ—Ä–∞—Ü–∏–π –º–æ–∂–Ω–æ –∏–∑–±–µ–∂–∞—Ç—å,
> –µ—Å–ª–∏ —à–∞—Ä–¥–∏—Ä–æ–≤–∞—Ç—å –ø–æ —Ç–æ–º—É –∫–ª—é—á—É, –≤–æ–∫—Ä—É–≥ –∫–æ—Ç–æ—Ä–æ–≥–æ –∂–∏–≤—ë—Ç –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞.

–ü—Ä–∏–º–µ—Ä—ã:

* user-centric ‚Üí –ø–æ userId
* —Å–µ—Ä–≤–∏—Å-–º—É–ª—å—Ç–∏–∞—Ä–µ–Ω–¥ ‚Üí –ø–æ tenantId
* –º–∞—Ä–∫–µ—Ç–ø–ª–µ–π—Å ‚Üí –ø–æ shopId
* –º–µ—Å—Å–µ–Ω–¥–∂–µ—Ä ‚Üí –ø–æ chatId

–ò –º–∏–Ω–∏–º—É–º cross-shard JOIN.

---

## üüß 3.2. –î–µ–Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è (—É–±–∏—Ç—å JOIN –ª—é–±–æ–π —Ü–µ–Ω–æ–π)

JOIN ‚Äî —É–±–∏–≤–∞–µ—Ç latency.
–ü–æ—ç—Ç–æ–º—É:

* username –∫–ª–∞–¥—ë–º –≤ order
* price –∫–ª–∞–¥—ë–º –≤ order
* sellerName –∫–ª–∞–¥—ë–º –≤ item

–ü–ª—é—Å—ã:

* –ª–æ–∫–∞–ª—å–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã
* –¥–µ—à—ë–≤—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏
* –Ω–µ—Ç cross-shard –ø–µ—Ä–µ—Ö–æ–¥–æ–≤

–ú–∏–Ω—É—Å—ã:

* eventual consistency
* event-driven –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
* –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ

---

## üü© 3.3. Scatter-Gather (fan-out)

–ß–∏—Å—Ç–æ —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏–π –±–ª–æ–∫:

* –∑–∞–ø—É—Å–∫–∞–µ–º –∑–∞–ø—Ä–æ—Å –ø–æ –≤—Å–µ–º —à–∞—Ä–¥–∞–º
* –ø–æ–ª—É—á–∞–µ–º partial results
* –∞–≥—Ä–µ–≥–∏—Ä—É–µ–º –∏ —Å–æ—Ä—Ç–∏—Ä—É–µ–º
* –≤–æ–∑–≤—Ä–∞—â–∞–µ–º –∫–ª–∏–µ–Ω—Ç—É

–ú–∏–Ω—É—Å—ã:

* tail latency —Ä–∞—Å—Ç—ë—Ç N —Ä–∞–∑
* slow shard = slow query

–ù–æ –∏–Ω–æ–≥–¥–∞ —ç—Ç–æ –µ–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω—ã–π —Å–ø–æ—Å–æ–±.

–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏:

* shard filtering
* early termination
* routing index (—Å–º. —Å–ª–µ–¥—É—é—â—É—é —Å—Ç—Ä–∞—Ç–µ–≥–∏—é)
* –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ partial results

---

## üü® 3.4. Routing Index (Directory-Based Sharding)

–ö–æ–≥–¥–∞ –Ω—É–∂–µ–Ω –ø–æ–∏—Å–∫ –±–µ–∑ –ø–æ–ª–Ω–æ–≥–æ —Ñ–∞–Ω-–∞—É—Ç–∞.

–û–ø–∏—Å–∞–Ω–∏–µ:

> –û—Ç–¥–µ–ª—å–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞ —Ö—Ä–∞–Ω–∏—Ç –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ:
> "–∫–∞–∫–∏–µ —à–∞—Ä–¥—ã —Å–æ–¥–µ—Ä–∂–∞—Ç –∫–∞–Ω–¥–∏–¥–∞—Ç–æ–≤ –ø–æ–¥ —ç—Ç–æ—Ç –∑–∞–ø—Ä–æ—Å".

–ü—Ä–∏–º–µ—Ä—ã:

* age index
* category index
* geo index

–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤:

* Cassandra
* Elastic
* Solr
* Pinterest

–≠—Ñ—Ñ–µ–∫—Ç ‚Äî –∑–∞–ø—Ä–æ—Å –∏–¥—ë—Ç –Ω–∞ 3 —à–∞—Ä–¥–∞, –∞ –Ω–µ –Ω–∞ 30.

---

## üü™ 3.5. Cross-shard Transactions ‚Üí Saga / Outbox

–¢–µ–∑–∏—Å—ã:

* ACID cross-shard –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
* 2PC —É–±–∏–≤–∞–µ—Ç –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å
* –Ω—É–∂–Ω–∞ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è –º–æ–¥–µ–ª—å

–ü–∞—Ç—Ç–µ—Ä–Ω—ã:

* Saga (—Å –∫–æ–º–ø–µ–Ω—Å–∞—Ü–∏–µ–π)
* Orchestration vs Choreography
* Outbox + CDC
* Idempotent handlers

–ü–æ—Å–ª–µ–¥—Å—Ç–≤–∏—è:

* eventual consistency
* –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç—å —Ä–µ—Ç—Ä–∞–µ–≤
* —Å–ª–æ–∂–Ω–æ—Å—Ç—å –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞

---

## üü• 3.6. Pre-Aggregation

–ü—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è –≤:

* YouTube
* TikTok
* Instagram
* Facebook Feed

–°—É—Ç—å:

> –ö–∞–∂–¥–∞—è –Ω–æ–¥–∞ —Å—á–∏—Ç–∞–µ—Ç —Å–≤–æ—é —á–∞—Å—Ç—å, –æ–±—â–∏–π —É–∑–µ–ª —Å–æ–±–∏—Ä–∞–µ—Ç.

–ü—Ä–∏–º–µ—Ä—ã:

* —Å—É–º–º–∞—Ä–Ω—ã–µ –ø—Ä–æ—Å–º–æ—Ç—Ä—ã
* –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ª–∞–π–∫–æ–≤
* –≥–ª–æ–±–∞–ª—å–Ω—ã–µ —Ç–æ–ø—ã

–°–∏–ª—å–Ω–æ —Å–Ω–∏–∂–∞–µ—Ç –Ω–∞–≥—Ä—É–∑–∫—É.

---

## üü´ 3.7. –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ cross-shard –∑–∞–ø—Ä–æ—Å–æ–≤

–¢–µ—Ö–Ω–∏–∫–∏:

* partial result caching
* whole-query caching
* materialized views
* time-bucketed aggregation

–ü—Ä–∏–º–µ—Ä:

* —Ç–æ–ø-100 —Ç–æ–≤–∞—Ä–æ–≤ –æ–±–Ω–æ–≤–ª—è—Ç—å —Ä–∞–∑ –≤ –º–∏–Ω—É—Ç—É
* –æ—Ç—á—ë—Ç—ã –æ–±–Ω–æ–≤–ª—è—Ç—å –∫–∞–∂–¥—ã–π —á–∞—Å

---

# üö´ 4. –ê–Ω—Ç–∏-–ø–∞—Ç—Ç–µ—Ä–Ω—ã

–û—á–µ–Ω—å –ø–æ–ª–µ–∑–Ω—ã–π, –∫–æ—Ä–æ—Ç–∫–∏–π –±–ª–æ–∫.

### ‚ùå REST JOIN

–ö–æ–≥–¥–∞ –æ–¥–∏–Ω —Å–µ—Ä–≤–∏—Å –¥–µ–ª–∞–µ—Ç JOIN —á–µ—Ä–µ–∑ —Å–µ—Ç—å —Å –¥—Ä—É–≥–∏–º.

### ‚ùå Blind scatter-gather –Ω–∞ –≤—Å–µ —à–∞—Ä–¥—ã

–•–≤–æ—Å—Ç –Ω–∞ –≤–∑–ª—ë—Ç.

### ‚ùå ACID —á–µ—Ä–µ–∑ –¥–≤–∞ —à–∞—Ä–¥–∞

–ó–≤—É—á–∏—Ç –∫—Ä–∞—Å–∏–≤–æ ‚Üí –≤ —Ä–µ–∞–ª–µ –ª–æ–º–∞–µ—Ç –∫–ª–∞—Å—Ç–µ—Ä.

### ‚ùå –ö–ª–∏–µ–Ω—Ç –∑–Ω–∞–µ—Ç, –Ω–∞ –∫–∞–∫–æ–π —à–∞—Ä–¥ –∏–¥—Ç–∏

–ù–∞—Ä—É—à–∞–µ—Ç –º–æ–±–∏–ª—å–Ω–æ—Å—Ç—å –¥–∞–Ω–Ω—ã—Ö, –ª–æ–º–∞–µ—Ç —Ä–µ-–±–∞–ª–∞–Ω—Å–∏–Ω–≥.

---

# üî• 5. –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –¥–ª—è hot keys

–í—Å—Ç–∞–≤–∫–∞ ‚Äú–∏–∑ —Ä–µ–∞–ª—å–Ω–æ–π –∂–∏–∑–Ω–∏‚Äù:

* microsharding
* caching
* write buffering
* –æ—Ç–¥–µ–ª—å–Ω—ã–π Redis tier
* –æ—Ç–¥–µ–ª—å–Ω–∞—è –ë–î –ø–æ–¥ –≥–æ—Ä—è—á–∏–µ –∫–ª—é—á–∏

–¢—ã –ø—Ä—è–º –æ–±—ä—è—Å–Ω—è–µ—à—å:

> Cross-shard ‚Äî —ç—Ç–æ –Ω–µ —Ç–æ–ª—å–∫–æ –ø—Ä–æ JOIN.
> Hot keys –º–æ–≥—É—Ç –≤—ã–∂–µ—á—å –æ–¥–∏–Ω —à–∞—Ä–¥ ‚Üí –∏ —Ç–æ–≥–¥–∞ –≤—Å–µ cross-shard —É—Ö—É–¥—à–∞—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏.

---

# üöÄ 6. –ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ –∏ –º–æ—Å—Ç–∏–∫ –∫ —Å–ª–µ–¥—É—é—â–µ–π —Ç–µ–º–µ

–§–∏–Ω–∞–ª—å–Ω—ã–µ —Ç–µ–∑–∏—Å—ã:

* Cross-shard ‚Äî –Ω–µ–∏–∑–±–µ–∂–Ω–∞—è —Ü–µ–Ω–∞ –∑–∞ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ.
* –ü–æ—á—Ç–∏ –≤—Å–µ–≥–¥–∞ —ç—Ç–æ –∫–æ–º–±–∏–Ω–∞—Ü–∏—è —Ç–µ—Ö–Ω–∏–∫.
* –°–∞–º–∞—è –≤–∞–∂–Ω–∞—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è ‚Äî **–º–∏–Ω–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å** cross-shard.
* –ü–æ—Å–ª–µ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –≤—Å—Ç–∞—ë—Ç —Å–ª–µ–¥—É—é—â–∏–π –≤–æ–ø—Ä–æ—Å:

```
–ê —á—Ç–æ –¥–µ–ª–∞—Ç—å, –∫–æ–≥–¥–∞ –æ–¥–∏–Ω —à–∞—Ä–¥ –ø–µ—Ä–µ–≥—Ä—É–∂–µ–Ω?
–ö–∞–∫ –ø–µ—Ä–µ–Ω–æ—Å–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –º–µ–∂–¥—É —à–∞—Ä–¥–æ–≤?
–ö–∞–∫ –¥–µ–ª–∞—Ç—å —ç—Ç–æ –±–µ–∑ –ø—Ä–æ—Å—Ç–æ—è?
```

‚Üí –ü–µ—Ä–µ—Ö–æ–¥ –∫ —Ç–µ–º–µ **Rebalancing & Online Migrations**.
