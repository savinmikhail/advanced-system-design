# üìò **–ü–ª–∞–Ω: Cross-Shard –æ–ø–µ—Ä–∞—Ü–∏–∏ –∏ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏**

*(–∏ –º–∞—Ç–µ—Ä–∏–∞–ª—ã –¥–ª—è –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∏)*

---

# üß® 0. –ë–û–õ–¨ (–ø–æ—á–µ–º—É –≤–æ–æ–±—â–µ —ç—Ç–∞ —Ç–µ–º–∞ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç)

–ß—ë—Ç–∫–æ –ø—Ä–æ–≥–æ–≤–æ—Ä–∏—Ç—å:

* –®–∞—Ä–¥–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ—à–∞–µ—Ç –ø—Ä–æ–±–ª–µ–º—É –º–∞—Å—à—Ç–∞–±–∞ –ë–î.
* –ù–æ –æ–Ω–æ –ø–æ—Ä–æ–∂–¥–∞–µ—Ç –Ω–æ–≤—É—é –ø—Ä–æ–±–ª–µ–º—É:
  **–¥–∞–Ω–Ω—ã–µ —Ç–µ–ø–µ—Ä—å —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω—ã, –∞ –±–∏–∑–Ω–µ—Å-–æ–ø–µ—Ä–∞—Ü–∏–∏ –Ω–µ—Ç.**

–¢–∏–ø–æ–≤—ã–µ –±–æ–ª–∏:

* –Ω—É–∂–Ω—ã–π –æ–±—ä–µ–∫—Ç –ø–æ–ø–∞–ª ‚Äú–Ω–µ –≤ —Ç–æ—Ç‚Äù —à–∞—Ä–¥
* JOIN —Å—Ç–∞–ª —Å–µ—Ç–µ–≤—ã–º –≤—ã–∑–æ–≤–æ–º
* —Ñ–∏–ª—å—Ç—Ä—ã / –ø–æ–∏—Å–∫ ‚Üí scatter-gather –ø–æ –≤—Å–µ–π —Å–∏—Å—Ç–µ–º–µ
* cross-shard —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ ‚Äú–∫–∞–∫ –≤ –º–æ–Ω–æ–ª–∏—Ç–µ‚Äù ‚Äî –Ω–µ–≤–æ–∑–º–æ–∂–Ω—ã
* —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å ‚Äú–ø–æ—Å—á–∏—Ç–∞—Ç—å —á—Ç–æ-—Ç–æ –≥–ª–æ–±–∞–ª—å–Ω–æ‚Äù –ª–æ–º–∞–µ—Ç latency –≤ 10√ó
* –æ–¥–∏–Ω –º–µ–¥–ª–µ–Ω–Ω—ã–π —à–∞—Ä–¥ –¥–µ–ª–∞–µ—Ç –º–µ–¥–ª–µ–Ω–Ω—ã–º –≤–µ—Å—å –∑–∞–ø—Ä–æ—Å

> –ì–ª–∞–≤–Ω–∞—è –º—ã—Å–ª—å:
> **–®–∞—Ä–¥–∏—Ä–æ–≤–∞–Ω–∏–µ —É–ª—É—á—à–∞–µ—Ç Throughput, –Ω–æ –ª–æ–º–∞–µ—Ç –ª–æ–≥–∏–∫—É –∑–∞–ø—Ä–æ—Å–æ–≤.**

---

# üß± 1. –ö–æ—Ä–æ—Ç–∫–æ–µ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ: —á—Ç–æ —Ç–∞–∫–æ–µ —à–∞—Ä–¥–∏—Ä–æ–≤–∞–Ω–∏–µ

*(–í–∞–∂–Ω—ã–π –±–ª–æ–∫ ‚Äî –º–Ω–æ–≥–∏–µ ‚Äú–ø–æ–Ω–∏–º–∞—é—Ç‚Äù, –Ω–æ –Ω–∞ —É—Ä–æ–≤–Ω–µ buzzword)*

–ö–æ—Ä–æ—Ç–∫–æ –ø–æ–≤—Ç–æ—Ä—è–µ—à—å:

* key-based sharding
* range-sharding
* geographic sharding
* directory-based (–∏–Ω–¥–µ–∫—Å-–æ—Ä–∏–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ)

–ò –≥–ª–∞–≤–Ω–∞—è –º—ã—Å–ª—å:

> –í—Å–µ –º–µ—Ç–æ–¥—ã —à–∞—Ä–¥–∏—Ä–æ–≤–∞–Ω–∏—è –≤–µ–¥—É—Ç –∫ —Ç–æ–º—É,
> —á—Ç–æ –¥–∞–Ω–Ω—ã–µ, –∫–æ—Ç–æ—Ä—ã–µ —Ä–∞–Ω—å—à–µ –±—ã–ª–∏ –ª–æ–∫–∞–ª—å–Ω—ã, —Ç–µ–ø–µ—Ä—å —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω—ã.

---

# üß® 2. –ü–æ—á–µ–º—É cross-shard –æ–ø–µ—Ä–∞—Ü–∏–∏ –ù–ï–ò–ó–ë–ï–ñ–ù–´

–¢–∏–ø–æ–≤—ã–µ —Å–ª—É—á–∞–∏, –≥–¥–µ –ø—Ä–∏–¥—ë—Ç—Å—è —Ö–æ–¥–∏—Ç—å –≤ —Ä–∞–∑–Ω—ã–µ —à–∞—Ä–¥—ã:

1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å A –ø–æ–∫—É–ø–∞–µ—Ç —É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è B (–¥–≤–µ —Å—É—â–Ω–æ—Å—Ç–∏ ‚Üí –¥–≤–∞ —à–∞—Ä–¥–∞)
2. JOIN –ø—Ä–æ—Ñ–∏–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏ –µ–≥–æ –∑–∞–∫–∞–∑–æ–≤
3. –§–∏–ª—å—Ç—Ä—ã –ø–æ –∞—Ç—Ä–∏–±—É—Ç–∞–º (age, price, category)
4. –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –∞–≥—Ä–µ–≥–∞—Ü–∏–∏ (—Å—É–º–º–∞, —Ç–æ–ø—ã, count)
5. –î–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏—è / unique checks
6. –í—ã–±–æ—Ä–∫–∏ ‚Äú–≤—Å–µ –∑–∞–∫–∞–∑—ã –∑–∞ –≤—á–µ—Ä–∞‚Äù
7. –ü–æ–¥—Å—á—ë—Ç —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫ –ø–æ –¥–∞—à–±–æ—Ä–¥—É

–ó–∞–¥–∞—á–∞: **–æ–±—ä—è—Å–Ω–∏—Ç—å —Å–ª—É—à–∞—Ç–µ–ª—é –º–∞—Å—à—Ç–∞–± –ø—Ä–æ–±–ª–µ–º—ã**, –∞ –Ω–µ –ø—Ä–æ—Å—Ç–æ –¥–∞—Ç—å –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ.

---

# üîç 3. –ö–∞—Ç–∞–ª–æ–≥ cross-shard –æ–ø–µ—Ä–∞—Ü–∏–π (–∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏—è)

–≠—Ç–∞ —á–∞—Å—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä—É–µ—Ç —Ö–∞–æ—Å:

### ‚úî 3.1. Cross-Shard JOIN

–ù—É–∂–Ω–æ —Å–≤—è–∑–∞—Ç—å –¥–∞–Ω–Ω—ã–µ –∏–∑ —Ä–∞–∑–Ω—ã—Ö —à–∞—Ä–¥–æ–≤.

### ‚úî 3.2. Cross-Shard Aggregation

SUM / COUNT / GROUP BY –ø–æ –≤—Å–µ–π —Å–∏—Å—Ç–µ–º–µ.

### ‚úî 3.3. Cross-Shard Filtering / Search

–õ—é–±–æ–π –∑–∞–ø—Ä–æ—Å –±–µ–∑ shard key ‚Üí fan-out.

### ‚úî 3.4. Cross-Shard Transactions

Atomicity across shards (—Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏).

### ‚úî 3.5. Cross-Shard Ordering / Pagination

–ì–ª–æ–±–∞–ª—å–Ω–∞—è —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –ø–æ timestamp.

### ‚úî 3.6. Scatter-Gather –∑–∞–ø—Ä–æ—Å—ã

–ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã–π –∑–∞–ø—Ä–æ—Å –Ω–∞ –≤—Å–µ —à–∞—Ä–¥—ã.

–°–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–µ –ë–î (Elastic, Mongo, Solr) –∂–∏–≤—É—Ç –Ω–∞ —ç—Ç–æ–º –º–µ—Ö–∞–Ω–∏–∑–º–µ.

---

# üõ† 4. –ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏

–í–æ—Ç –≥–ª–∞–≤–Ω—ã–π –±–ª–æ–∫.
–ö–∞–∂–¥–∞—è —Å—Ç—Ä–∞—Ç–µ–≥–∏—è –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å —Å –ø–ª—é—Å–æ–º –∏ –º–∏–Ω—É—Å–æ–º.

---

## üü¶ 4.1. –ü—Ä–∞–≤–∏–ª—å–Ω—ã–π –≤—ã–±–æ—Ä shard key (Data Locality)

**99% cross-shard –±–æ–ª–∏ –ª–µ—á–∏—Ç—Å—è –≤—ã–±–æ—Ä–æ–º –ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ –∫–ª—é—á–∞.**

–ü—Ä–∏–º–µ—Ä—ã:

* –≤ e-commerce –≤—Å—ë –≤–æ–∫—Ä—É–≥ userId
* –≤ CRM –≤—Å—ë –≤–æ–∫—Ä—É–≥ tenantId
* –≤ –º–µ—Å—Å–µ–Ω–¥–∂–µ—Ä–∞—Ö –≤—Å—ë –≤–æ–∫—Ä—É–≥ chatId
* –≤ –º–∞—Ä–∫–µ—Ç–ø–ª–µ–π—Å–µ sellerId –∏–ª–∏ shopId

–≠—Ç–æ –∫–ª—é—á–µ–≤–∞—è –∏–Ω–∂–µ–Ω–µ—Ä–Ω–∞—è –º—ã—Å–ª—å:

> –ï—Å–ª–∏ —à–∞—Ä–¥–∏—Ä–æ–≤–∞—Ç—å –ø–æ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–º—É –∫–ª—é—á—É ‚Äî —Ç—ã –ø–æ—á—Ç–∏ –Ω–µ –¥–µ–ª–∞–µ—à—å cross-shard.

---

## üüß 4.2. –î–µ–Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è –≤–º–µ—Å—Ç–æ JOIN

JOIN ‚Äî —Å–º–µ—Ä—Ç—å —Ä–∞—Å–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω—ã—Ö —Å–∏—Å—Ç–µ–º.

–ü–æ—ç—Ç–æ–º—É:

* –¥—É–±–ª–∏—Ä—É–µ–º username –≤ order
* –¥—É–±–ª–∏—Ä—É–µ–º —Ü–µ–Ω—É —Ç–æ–≤–∞—Ä–∞ –≤ order
* –¥—É–±–ª–∏—Ä—É–µ–º –∞–≤–∞—Ç–∞—Ä–∫–∏, —Å—Ç–∞—Ç—É—Å—ã, —Ñ–ª–∞–≥–∏

–°—Ö–µ–º–∞:

* –≤–º–µ—Å—Ç–æ –æ–¥–Ω–æ–≥–æ –≥–ª–æ–±–∞–ª—å–Ω–æ–≥–æ JOIN ‚Üí –ª–æ–∫–∞–ª—å–Ω—ã–π read

–ú–∏–Ω—É—Å—ã:

* eventual inconsistency
* —Å–ª–æ–∂–Ω–∞—è –∏–Ω–≤–∞–ª–∏–¥–∞—Ü–∏—è
* –Ω—É–∂–µ–Ω event-driven sync

–ù–æ —ç—Ç–æ –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞ –∫—Ä—É–ø–Ω—ã—Ö –∫–æ–º–ø–∞–Ω–∏–π.

---

## üü© 4.3. Scatter-Gather (Fan-Out)

–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤:

* MongoDB
* Elasticsearch
* Solr
* Cassandra (—á–∞—Å—Ç–∏—á–Ω–æ)

–û–ø–∏—Å–∞–Ω–∏–µ:

1. –ó–∞–ø—Ä–æ—Å –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –Ω–∞ –Ω–µ—Å–∫–æ–ª—å–∫–æ —à–∞—Ä–¥–æ–≤ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ
2. –ö–∞–∂–¥—ã–π —à–∞—Ä–¥ –≤—ã–ø–æ–ª–Ω—è–µ—Ç –ª–æ–∫–∞–ª—å–Ω—ã–π –ø–æ–∏—Å–∫
3. Central node –∞–≥—Ä–µ–≥–∏—Ä—É–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã

–ú–∏–Ω—É—Å—ã:

* tail latency —Ä–∞—Å—Ç—ë—Ç –∫—Ä–∞—Ç–Ω–æ
* –æ–¥–∏–Ω slow shard –¥–µ–ª–∞–µ—Ç –≤–µ—Å—å –ø–æ–∏—Å–∫ –º–µ–¥–ª–µ–Ω–Ω—ã–º

–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏:

* shard filtering
* routing index
* caching partial results
* early termination

---

## üü® 4.4. Routing Index / Directory-Based Sharding

–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤:

* Cassandra
* Pinterest
* Elasticsearch (routing)
* Bigtable (tablet metadata)

–ò–¥–µ—è:

> —Ö—Ä–∞–Ω–∏—Ç—å –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ –æ —Ç–æ–º, –≥–¥–µ –ª–µ–∂–∞—Ç –Ω—É–∂–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ.

–ü—Ä–∏–º–µ—Ä:

```
age 18‚Üí25 ‚Üí shards [2,5,7]
premium = true ‚Üí shard 3
```

–≠—Ñ—Ñ–µ–∫—Ç:

* –º–µ–Ω—å—à–µ —Ñ–∞–Ω–∞—É—Ç–∞
* –ø—Ä–µ–¥—Å–∫–∞–∑—É–µ–º–æ—Å—Ç—å –∑–∞–ø—Ä–æ—Å–æ–≤
* —É–º–µ–Ω—å—à–µ–Ω–∏–µ latency

---

## üü™ 4.5. Cross-Shard Transactions ‚Üí Saga / Outbox

–°—É—Ç—å:

* –Ω–µ—Ç ACID across shards
* 2PC —É–±–∏–≤–∞–µ—Ç –º–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å
* –Ω—É–∂–µ–Ω –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π workflow

–ü–∞—Ç—Ç–µ—Ä–Ω—ã:

* Saga (compensation)
* Orchestration / Choreography
* Outbox + CDC
* Idempotent commands

–ú–∏–Ω—É—Å: eventual consistency –Ω–µ–∏–∑–±–µ–∂–Ω–∞.

---

## üü• 4.6. Pre-aggregation (MapReduce approach)

–î–ª—è –≥–ª–æ–±–∞–ª—å–Ω—ã—Ö –º–µ—Ç—Ä–∏–∫:

* –∫–∞–∂–¥—ã–π —à–∞—Ä–¥ —Å—á–∏—Ç–∞–µ—Ç —Å–≤–æ—é —á–∞—Å—Ç—å
* —Ü–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã–π —É–∑–µ–ª –æ–±—ä–µ–¥–∏–Ω—è–µ—Ç

–¢–∞–∫ —Å—á–∏—Ç–∞–µ—Ç:

* Facebook Feed
* TikTok counters
* YouTube views
* Google Bigtable aggregations

---

## üü´ 4.7. –ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ cross-shard –∑–∞–ø—Ä–æ—Å–æ–≤

* partial results cache
* whole query cache
* materialized views
* time-bucketed precomputed tables

–°–∏–ª—å–Ω—ã–π —Ç—Ä—é–∫:

> –ï—Å–ª–∏ –∑–∞–ø—Ä–æ—Å –Ω–µ–∏–∑–±–µ–∂–Ω–æ cross-shard ‚Äî —Å–¥–µ–ª–∞–π —Ç–∞–∫, —á—Ç–æ–±—ã –µ–≥–æ –Ω–µ –≤—ã–∑—ã–≤–∞–ª–∏ —á–∞—Å—Ç–æ.

---

# üö´ 5. Anti-Patterns

### ‚ùå –ì–ª–æ–±–∞–ª—å–Ω—ã–π JOIN —á–µ—Ä–µ–∑ REST

¬´–°–µ—Ä–≤–∏—Å Users –ø–æ–∑–æ–≤–∏ Orders, –∞ —ç—Ç–æ—Ç –ø–æ–∑–æ–≤–∏ Billing¬ª.

–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ distributed O(N¬≤) latency.

### ‚ùå –ù–∞–∏–≤–Ω—ã–π fan-out –Ω–∞ –≤—Å–µ —à–∞—Ä–¥—ã –±–µ–∑ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏

–°–∂–∏–≥–∞–µ—Ç CPU, –ø–æ—Ä–æ–∂–¥–∞–µ—Ç tail latency.

### ‚ùå ACID —á–µ—Ä–µ–∑ –¥–≤–∞ —à–∞—Ä–¥–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö —Å–µ—Ä–≤–∏—Å–∞

*–¢—ã –Ω–µ –≥—É–≥–ª.*
–£ —Ç–µ–±—è –Ω–µ Spanner.

### ‚ùå –ö–ª–∏–µ–Ω—Ç –∑–Ω–∞–µ—Ç, –≥–¥–µ –∫–∞–∫–∏–µ —à–∞—Ä–¥—ã

–≠—Ç–æ –ª–æ–º–∞–µ—Ç –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ.

---

# üß© 6. –ß—Ç–æ –¥–µ–ª–∞—Ç—å —Å hot keys

–°—Ä–∞–∑—É —Å—é–¥–∞:

* –æ—Ç–¥–µ–ª—å–Ω—ã–π tier (Redis/Memcache)
* microsharding
* token bucketing
* write-behind buffers
* caching in front of shard

---

# üîÆ 7. –ü–æ–¥–≤–æ–¥–∫–∞ –∫ —Å–ª–µ–¥—É—é—â–µ–π —Ç–µ–º–µ (Rebalancing & –º–∏–≥—Ä–∞—Ü–∏–∏)

–§–∏–Ω–∞–ª—å–Ω–∞—è –º—ã—Å–ª—å:

> –ß—Ç–æ–±—ã Cross-Shard —Ä–∞–±–æ—Ç–∞–ª–∏ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ,
> —Å–∞–º–∏ —à–∞—Ä–¥—ã –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å —Å–±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∞–Ω—ã –∏ –º–∏–≥—Ä–∏—Ä—É–µ–º—ã **–±–µ–∑ downtime**.

–ò –ª–æ–≥–∏—á–Ω—ã–π –ø–µ—Ä–µ—Ö–æ–¥ –∫:

* –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–º—É —à–∞—Ä–¥–∏—Ä–æ–≤–∞–Ω–∏—é
* online migrations
* reshuffling
* rebalancing strategies
