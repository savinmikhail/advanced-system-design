# üé¨ **–ü–õ–ê–ù –°–¶–ï–ù–ê–†–ò–Ø: Rebalancing –∏ Online Migration –±–µ–∑ Downtime**

## üß® 0. –í—Å—Ç—É–ø–ª–µ–Ω–∏–µ: ‚Äú–ü–æ—á–µ–º—É –≤–æ–æ–±—â–µ –Ω—É–∂–µ–Ω Rebalancing?‚Äù (1 –º–∏–Ω—É—Ç–∞)

–ë–æ–ª—å:

* –û–¥–∏–Ω —à–∞—Ä–¥ —Ä–∞–∑—Ä–æ—Å—Å—è –±—ã—Å—Ç—Ä–µ–µ –æ—Å—Ç–∞–ª—å–Ω—ã—Ö
* –û–¥–∏–Ω —à–∞—Ä–¥ —Å—Ç–∞–ª hot spot
* –û–¥–∏–Ω —à–∞—Ä–¥ –ø–µ—Ä–µ–≥—Ä—É–∂–µ–Ω –∑–∞–ø—Ä–æ—Å–∞–º–∏
* –£ shard key –ø–ª–æ—Ö–∞—è –∫–∞—Ä–¥–∏–Ω–∞–ª—å–Ω–æ—Å—Ç—å
* –ü—Ä–æ–µ–∫—Ç –≤—ã—Ä–æ—Å ‚Üí –Ω—É–∂–Ω–æ –±–æ–ª—å—à–µ —à–∞—Ä–¥–æ–≤
* –ù–∞ —Å—Ç–∞—Ä—Ç–µ –±—ã–ª–∞ —Å—Ç–∞—Ç–∏–∫–∞ (‚Äúcustomer_id % 8‚Äù) ‚Äî —Ç–µ–ø–µ—Ä—å –Ω—É–∂–Ω–æ 16 —à–∞—Ä–¥–æ–≤

–ò –≥–ª–∞–≤–Ω—ã–π –º–æ–º–µ–Ω—Ç:

> –ö–æ–≥–¥–∞ —à–∞—Ä–¥—ã –Ω–µ—Å–±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∞–Ω—ã ‚Äî cross-shard –æ–ø–µ—Ä–∞—Ü–∏–∏ –Ω–∞—á–∏–Ω–∞—é—Ç —É–º–∏—Ä–∞—Ç—å –ø–µ—Ä–≤—ã–º–∏.

---

# üß© 1. –í–∏–¥—ã –º–∏–≥—Ä–∞—Ü–∏–π (2 –º–∏–Ω—É—Ç—ã)

–ö–æ—Ä–æ—Ç–∫–æ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º, —á—Ç–æ ‚Äú–º–∏–≥—Ä–∞—Ü–∏—è‚Äù ‚Äî —ç—Ç–æ –Ω–µ –æ–¥–Ω–æ –¥–µ–π—Å—Ç–≤–∏–µ, –∞ –ø—è—Ç—å —Ä–∞–∑–Ω—ã—Ö —Ç–∏–ø–æ–≤:

### ‚úî 1.1. Resharding (–ø–µ—Ä–µ—Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –∫–ª—é—á–µ–π)

–ü–µ—Ä–µ—Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –º–µ–∂–¥—É —Ç–µ–º–∏ –∂–µ —à–∞—Ä–¥-—Å–µ—Ä–≤–µ—Ä–∞–º–∏.

### ‚úî 1.2. Upscaling (–¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤—ã—Ö —à–∞—Ä–¥–æ–≤)

–ë—ã–ª–æ N —à–∞—Ä–¥–æ–≤ ‚Üí —Å—Ç–∞–ª–æ N+K.

### ‚úî 1.3. Downscaling (—Å–ª–∏—è–Ω–∏–µ —à–∞—Ä–¥–æ–≤)

–ö–æ–≥–¥–∞ –ø–µ—Ä–µ—Å—Ç–∞–ª–∏ –Ω—É–∂–Ω—ã 100 —à–∞—Ä–¥–æ–≤.

### ‚úî 1.4. Online relocation (–ø–µ—Ä–µ–º–µ—â–µ–Ω–∏–µ —á–∞—Å—Ç–∏ –∫–ª—é—á–µ–π)

–ù–∞–∏–±–æ–ª–µ–µ —á–∞—Å—Ç–∞—è –æ–ø–µ—Ä–∞—Ü–∏—è: ‚Äú–ø–µ—Ä–µ–Ω–µ—Å—Ç–∏ shard region X ‚Üí Y‚Äù.

### ‚úî 1.5. Shard key migration (—Å–º–µ–Ω–∞ —Å–ø–æ—Å–æ–±–∞ —à–∞—Ä–¥–∏—Ä–æ–≤–∞–Ω–∏—è)

–°–∞–º—ã–π —Ç—Ä—É–¥–Ω—ã–π –≤–∞—Ä–∏–∞–Ω—Ç. –ò–Ω–æ–≥–¥–∞ –Ω–µ–∏–∑–±–µ–∂–µ–Ω.

–≠—Ç–æ –∑–∞–¥–∞—ë—Ç –∫–æ–Ω—Ç–µ–∫—Å—Ç.

---

# üõë 2. –ë–æ–ª—å —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏—Ö —Å—Ö–µ–º (2 –º–∏–Ω—É—Ç—ã)

* customer_id % 8 ‚Üí –∫–∞–∫ —Ç–æ–ª—å–∫–æ –Ω—É–∂–Ω–æ 16 —à–∞—Ä–¥–æ–≤ ‚Äî –≤—Å—ë —É–º–µ—Ä–ª–æ
* –Ω–µ–≤–æ–∑–º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–µ —É–∑–ª—ã –±–µ–∑ –ø–æ–ª–Ω–æ–π –º–∏–≥—Ä–∞—Ü–∏–∏
* –Ω–µ–ª—å–∑—è –º–µ–Ω—è—Ç—å —à–∞—Ä–¥-–≥—Ä–∞–Ω–∏—Ü—ã –±–µ–∑ –¥–∞—É–Ω—Ç–∞–π–º–∞
* –Ω–µ–ª—å–∑—è –≤—ã–¥–µ–ª—è—Ç—å –≥–æ—Ä—è—á–∏–µ —Å–µ–≥–º–µ–Ω—Ç—ã –≤ –æ—Ç–¥–µ–ª—å–Ω—ã–π tier
* –Ω–µ–≤–æ–∑–º–æ–∂–Ω–æ online-resolve ‚Äúhot shard‚Äù –ø—Ä–æ–±–ª–µ–º—É

–§—Ä–∞–∑–∞, –∫–æ—Ç–æ—Ä—É—é —Ç—ã –º–æ–∂–µ—à—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å:

> ‚Äú–°—Ç–∞—Ç–∏—á–µ—Å–∫–æ–µ —à–∞—Ä–¥–∏—Ä–æ–≤–∞–Ω–∏–µ ‚Äî —ç—Ç–æ —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏–π –¥–æ–ª–≥, –∫–æ—Ç–æ—Ä—ã–π –≤—Å–µ–≥–¥–∞ —Å –ø—Ä–æ—Ü–µ–Ω—Ç–∞–º–∏.‚Äù

---

# üß† 3. –ü—Ä–æ–±–ª–µ–º—ã, –∫–æ—Ç–æ—Ä—ã–µ –Ω–∞–¥–æ —Ä–µ—à–∞—Ç—å –ø—Ä–∏ rebalancing (3 –º–∏–Ω—É—Ç—ã)

–ó–¥–µ—Å—å –æ–ø–∏—Å—ã–≤–∞–µ–º —Ä–µ–∞–ª—å–Ω—É—é –∏–Ω–∂–µ–Ω–µ—Ä–Ω—É—é –±–æ–ª—å:

### ‚úî 3.1. –î–∞–Ω–Ω—ã–µ –Ω–µ–∫–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω—ã –≤–æ –≤—Ä–µ–º—è –º–∏–≥—Ä–∞—Ü–∏–∏

–£—Ç–µ—á–∫–∏, –¥—É–±–ª–∏, ‚Äúsplit brain‚Äù –º–µ–∂–¥—É —à–∞—Ä–¥–∞–º–∏.

### ‚úî 3.2. –ù–µ–ª—å–∑—è –ª–æ–º–∞—Ç—å SLA

–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –¥–æ–ª–∂–µ–Ω –ø–æ–Ω–∏–º–∞—Ç—å, —á—Ç–æ —É –Ω–µ–≥–æ –ø–µ—Ä–µ–µ–∑–∂–∞–µ—Ç 50 –ì–ë –¥–∞–Ω–Ω—ã—Ö.

### ‚úî 3.3. Race conditions

–ó–∞–ø–∏—Å—å –ø—Ä–æ–∏–∑–æ—à–ª–∞ –≤–æ –≤—Ä–µ–º—è –ø–µ—Ä–µ–Ω–æ—Å–∞.

### ‚úî 3.4. Atomic switch-over

–ù—É–∂–µ–Ω —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–æ–Ω–Ω—ã–π –º–æ–º–µ–Ω—Ç ‚Äú–¥–æ —ç—Ç–æ–≥–æ —á–∏—Ç–∞–ª —Å—Ç–∞—Ä—ã–π —à–∞—Ä–¥, –ø–æ—Å–ª–µ ‚Äî –Ω–æ–≤—ã–π‚Äù.

### ‚úî 3.5. –ù–∞–≥—Ä—É–∑–∫–∞ –Ω–∞ —Å–µ—Ç—å

Rebalancing ‚Äî —ç—Ç–æ DDoS –Ω–∞ —Ç–≤–æ–π –∂–µ –∫–ª–∞—Å—Ç–µ—Ä, –µ—Å–ª–∏ –ø–ª–æ—Ö–æ —Å–¥–µ–ª–∞—Ç—å.

### ‚úî 3.6. –í–ª–∏—è–Ω–∏–µ –Ω–∞ –∫–µ—à–∏

–†–∏—Å–∫:

* stale data
* cache poisoning
* —É—Å—Ç–∞—Ä–µ–≤—à–∏–µ –º–∞—Ä—à—Ä—É—Ç—ã

---

# ‚öôÔ∏è 4. –ü–æ–¥—Ö–æ–¥—ã –∫ Rebalancing (8‚Äì10 –º–∏–Ω—É—Ç)

–¢–µ–ø–µ—Ä—å ‚Äî –º—è—Å–æ.

---

## üü¶ 4.1. ‚Äú–î–≤–æ–π–Ω–∞—è –∑–∞–ø–∏—Å—å‚Äù (Dual Write)

(–Ω–∞–∏–±–æ–ª–µ–µ –∏–∑–≤–µ—Å—Ç–Ω—ã–π, –Ω–æ –æ–ø–∞—Å–Ω—ã–π)

–ê–ª–≥–æ—Ä–∏—Ç–º:

1. –ü–∏—à–µ–º –≤ —Å—Ç–∞—Ä—ã–π + –Ω–æ–≤—ã–π —à–∞—Ä–¥
2. –ß—Ç–µ–Ω–∏–µ –∏–¥—ë—Ç –∏–∑ —Å—Ç–∞—Ä–æ–≥–æ
3. –ö–æ–≥–¥–∞ –¥–∞–Ω–Ω—ã–µ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω—ã ‚Üí –ø–µ—Ä–µ–∫–ª—é—á–∞–µ–º —á—Ç–µ–Ω–∏–µ
4. –°—Ç–∞—Ä—ã–π –∏—Å—Ç–æ—á–Ω–∏–∫ –≤—ã–∫–ª—é—á–∞–µ–º

–û–ø–∞—Å–Ω–æ—Å—Ç–∏:

* —Ä–∞—Å—Å–∏–Ω—Ö—Ä–æ–Ω
* —Ä–∞–∑–Ω—ã–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –≤ —Ä–∞–∑–Ω–æ–µ –≤—Ä–µ–º—è
* —Å–ª–æ–∂–Ω—ã–µ race conditions
* –ø—Ä–æ–±–ª–µ–º–∞ ‚Äú–¥–≤–æ–π–Ω–æ–π –∏–Ω–∫—Ä–µ–º–µ–Ω—Ç–∞—Ü–∏–∏‚Äù

–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ç–æ–ª—å–∫–æ –¥–ª—è ‚Äú–ø—Ä–æ—Å—Ç—ã—Ö‚Äù –∫–æ–ª–ª–µ–∫—Ü–∏–π.

---

## üü© 4.2. ‚ÄúRead-from-old, write-to-new‚Äù + Repair Worker

(–±–µ–∑–æ–ø–∞—Å–Ω–µ–µ, —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–π –≤–∞—Ä–∏–∞–Ω—Ç)

–ê–ª–≥–æ—Ä–∏—Ç–º:

1. –ü–∏—à–µ–º –≤ –Ω–æ–≤—ã–π —à–∞—Ä–¥
2. –ß–∏—Ç–∞–µ–º –ø–æ–∫–∞ –∏–∑ —Å—Ç–∞—Ä–æ–≥–æ
3. –§–æ–Ω–æ–≤—ã–π –≤–æ—Ä–∫–µ—Ä –ø–µ—Ä–µ–Ω–æ—Å–∏—Ç –Ω–æ–≤—ã–µ –∑–∞–ø–∏—Å–∏
4. –ö–æ–≥–¥–∞ –¥–æ–≥–Ω–∞–ª–∏ ‚Üí –ø–µ—Ä–µ–∫–ª—é—á–∞–µ–º —á—Ç–µ–Ω–∏—è

–ü–ª—é—Å—ã:

* –∞—Ç–æ–º–∞—Ä–Ω—ã–π –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—å
* –ø—Ä–æ—â–µ reasoning
* –º–æ–∂–Ω–æ –æ—Ç–∫–∞—Ç—ã–≤–∞—Ç—å

–ú–∏–Ω—É—Å—ã:

* —Å–ª–æ–∂–Ω–æ—Å—Ç—å —á–∏—Å—Ç–∫–∏ –æ—Å—Ç–∞—Ç–æ—á–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö

---

## üüß 4.3. "Change Routing First" (–ø–æ–º–µ–Ω—è—Ç—å –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—é, –ø–æ—Ç–æ–º –º–∏–≥—Ä–∏—Ä–æ–≤–∞—Ç—å)

–ò—Å–ø–æ–ª—å–∑—É—é—Ç LinkedIn, Twitter, Uber.

–ê–ª–≥–æ—Ä–∏—Ç–º:

1. –ú–µ–Ω—è–µ–º shard map: ‚Äú—ç—Ç–∏ –∫–ª—é—á–∏ –æ–±—Å–ª—É–∂–∏–≤–∞–µ—Ç –Ω–æ–≤—ã–π —à–∞—Ä–¥‚Äù
2. –ß–∏—Ç–∞—Ç–µ–ª–∏ –∏ –ø–∏—Å–∞—Ç–µ–ª–∏ –∏–¥—É—Ç –≤ –Ω–æ–≤—ã–π
3. –§–æ–Ω–æ–≤—ã–π –ø—Ä–æ—Ü–µ—Å—Å –ø–µ—Ä–µ–Ω–æ—Å–∏—Ç —Ö–æ–ª–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
4. –°—Ç–∞—Ä—ã–π —à–∞—Ä–¥ —á–∏—Å—Ç–∏—Ç—Å—è

–ü–ª—é—Å—ã:

* –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–π downtime
* –±–µ–∑–æ–ø–∞—Å–Ω–æ –¥–ª—è –≥–æ—Ä—è—á–∏—Ö –∫–ª—é—á–µ–π

–ú–∏–Ω—É—Å—ã:

* –Ω—É–∂–Ω–æ —É–º–µ—Ç—å –∂–∏—Ç—å —Å –¥–∞–Ω–Ω—ã–º–∏, –∫–æ—Ç–æ—Ä—ã–µ –≤ –¥–≤—É—Ö –º–µ—Å—Ç–∞—Ö

---

## üü• 4.4. Change Data Capture (CDC) + Backfill

(—Å–æ–≤—Ä–µ–º–µ–Ω–Ω–æ, –Ω–∞–¥—ë–∂–Ω–æ, –æ—Å–æ–±–µ–Ω–Ω–æ –µ—Å–ª–∏ Kafka)

–ê–ª–≥–æ—Ä–∏—Ç–º:

1. –°—Ç—Ä–∏–º –∏–∑–º–µ–Ω–µ–Ω–∏–π —Å—Ç–∞—Ä–æ–≥–æ —à–∞—Ä–¥–∞ ‚Üí Kafka
2. –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ backfill –∏–∑ snapshot'–∞
3. Kafka –¥–æ–≥–æ–Ω—è–µ—Ç —Ö–≤–æ—Å—Ç
4. –ü–µ—Ä–µ–∫–ª—é—á–∞–µ–º —á—Ç–µ–Ω–∏–µ

–≠—Ç–æ –∫–∞–∫ Uber –∏ Pinterest –¥–µ–ª–∞—é—Ç –±–æ–ª—å—à–∏–µ –º–∏–≥—Ä–∞—Ü–∏–∏.

---

## üü™ 4.5. Live Traffic Replay (–¥–ª—è high-traffic —Å–∏—Å—Ç–µ–º)

–ò—Å–ø–æ–ª—å–∑—É—é—Ç:

* AWS DynamoDB
* Spanner migrations
* Alibaba migrations

–ê–ª–≥–æ—Ä–∏—Ç–º:

1. –õ–æ–≤–∏–º –≤–µ—Å—å —Ç—Ä–∞—Ñ–∏–∫ –Ω–∞ —Å—Ç–∞—Ä—ã–π —à–∞—Ä–¥
2. Replay'–∏–º –µ–≥–æ –≤ –Ω–æ–≤—ã–π
3. –î–æ–∂–∏–¥–∞–µ–º—Å—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏
4. –†–æ–≤–Ω—ã–π switch

–û—á–µ–Ω—å –Ω–∞–¥—ë–∂–Ω–æ, –Ω–æ —Å–ª–æ–∂–Ω–æ.

---

# üß¨ 5. Atomic Cutover (–ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –±–µ–∑ –¥–∞—É–Ω—Ç–∞–π–º–∞) (2‚Äì3 –º–∏–Ω—É—Ç—ã)

–ö–ª—é—á–µ–≤–æ–π –º–æ–º–µ–Ω—Ç:

> –í –º–∏–≥—Ä–∞—Ü–∏–∏ –≤–∞–∂–Ω–æ –Ω–µ –∫–∞–∫ –ø–µ—Ä–µ–Ω–æ—Å–∏—Ç—å –¥–∞–Ω–Ω—ã–µ.
> –í–∞–∂–Ω–æ –∫–∞–∫ –ø–µ—Ä–µ–∫–ª—é—á–∏—Ç—å —á—Ç–µ–Ω–∏–µ –∏ –∑–∞–ø–∏—Å—å –∞—Ç–æ–º–∞—Ä–Ω–æ.

–¢–µ—Ö–Ω–∏–∫–∏:

### ‚úî Feature flag

–ü–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—å –Ω–∞ —É—Ä–æ–≤–µ–Ω—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è.

### ‚úî Routing map generation

–°—Ç–∞—Ä–∞—è –∫–∞—Ä—Ç–∞ ‚Üí –Ω–æ–≤–∞—è –∫–∞—Ä—Ç–∞ ‚Üí –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ.

### ‚úî Epoch / Generation ID

–ö–∞–∂–¥—ã–π —à–∞—Ä–¥ –∏–º–µ–µ—Ç ‚Äú–Ω–æ–º–µ—Ä –ø–æ–∫–æ–ª–µ–Ω–∏—è‚Äù.
–ï—Å–ª–∏ –∫–ª–∏–µ–Ω—Ç –ø—Ä–∏—Å—ã–ª–∞–µ—Ç –∑–∞–ø—Ä–æ—Å —Å–æ —Å—Ç–∞—Ä–æ–π generation ‚Üí redirect.

### ‚úî Read-repair

–ï—Å–ª–∏ –∑–∞–ø—Ä–æ—Å —É—à—ë–ª —Å—Ç–∞—Ä–æ–º—É —É–∑–ª—É ‚Üí –æ–Ω –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç redirect –Ω–∞ –Ω–æ–≤—ã–π.

---

# üß® 6. –ü—Ä–æ–±–ª–µ–º–∞ –±–µ–≥—É—â–∏—Ö –∑–∞–ø–∏—Å–µ–π (in-flight writes) (2 –º–∏–Ω—É—Ç—ã)

–û–ø–∏—Å—ã–≤–∞–µ–º –∫–ª–∞—Å—Å–∏—á–µ—Å–∫—É—é –±–æ–ª—å:

* –∑–∞–ø–∏—Å—å –ø—Ä–∏–ª–µ—Ç–∞–µ—Ç –≤ —Å—Ç–∞—Ä—ã–π —à–∞—Ä–¥ –≤ –º–æ–º–µ–Ω—Ç –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è
* –∑–∞–ø–∏—Å—å —Ç–µ—Ä—è–µ—Ç—Å—è
* –∑–∞–ø–∏—Å—å –ø–æ—è–≤–ª—è–µ—Ç—Å—è –≤ –¥–≤—É—Ö –º–µ—Å—Ç–∞—Ö
* –∫—ç—à —É—Å—Ç–∞—Ä–µ–≤—à–∏–π
* saga –ª–æ–º–∞–µ—Ç—Å—è

–†–µ—à–µ–Ω–∏—è:

* –ø–∞—É–∑–∞ –ø–∏—Å–∞—Ç–µ–ª–µ–π (short freeze < 50ms)
* idempotency
* version vectors
* sequence tokens
* write fencing (–ø–∏—à–µ–º —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ generation —Å–æ–≤–ø–∞–¥–∞–µ—Ç)

---

# üßπ 7. –û—á–∏—Å—Ç–∫–∞ ‚Äú–º—É—Å–æ—Ä–∞‚Äù (–ø–æ—Å—Ç-–º–∏–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–π —ç—Ç–∞–ø) (1 –º–∏–Ω—É—Ç–∞)

–ó–¥–µ—Å—å –∫–æ—Ä–æ—Ç–∫–æ:

* —Å—Ç–∞—Ä—ã–µ –¥–∞–Ω–Ω—ã–µ
* —Å—Ç–∞—Ä—ã–µ –∫–µ—à–∏
* stale –∏–Ω–¥–µ–∫—Å–Ω—ã–µ –∑–∞–ø–∏—Å–∏
* orphaned keys

–ù—É–∂–Ω–∞:

* GC –≤–æ—Ä–∫–µ—Ä
* TTL
* version purge

---

# üö´ 8. –ê–Ω—Ç–∏-–ø–∞—Ç—Ç–µ—Ä–Ω—ã (1 –º–∏–Ω—É—Ç–∞)

–ë—ã—Å—Ç—Ä–æ –∏ –∂—ë—Å—Ç–∫–æ:

### ‚ùå ‚Äú–ü–µ—Ä–µ–µ—Ö–∞–ª–∏ –ø—Ä–æ—Å—Ç–æ SELECT * INTO ‚Ä¶‚Äù

–≠—Ç–æ offline migration, —É–±–∏–≤–∞–µ—Ç SLA.

### ‚ùå ‚Äú–°–Ω–∞—á–∞–ª–∞ –≤—ã–∫–ª—é—á–∏–º —Å—Ç–∞—Ä—ã–π —à–∞—Ä–¥‚Ä¶‚Äù

–£–º–∏—Ä–∞–µ—Ç –≤–µ—Å—å —Ç—Ä–∞—Ñ–∏–∫.

### ‚ùå ‚Äú–ö–ª–∏–µ–Ω—Ç —Å–∞–º –∑–Ω–∞–µ—Ç, –∫—É–¥–∞ –ø–∏—Å–∞—Ç—å‚Äù

–†–∞–∑–≤–∞–ª–∏—Ç –ª—é–±—É—é –º–∏–≥—Ä–∞—Ü–∏—é.

### ‚ùå ‚Äú–°–¥–µ–ª–∞–µ–º –≤—Å—ë –∑–∞ –æ–¥–∏–Ω –±–æ–ª—å—à–æ–π —Å–∫—Ä–∏–ø—Ç‚Äù

–ù–∏–∫–æ–≥–¥–∞ –Ω–µ –ø–æ–ª—É—á–∏—Ç—Å—è –≤ production.

---

# üî• 9. –ü—Ä–∏–º–µ—Ä –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã –æ–Ω–ª–∞–π–Ω-–º–∏–≥—Ä–∞—Ü–∏–∏ (mermaid –¥–∏–∞–≥—Ä–∞–º–º–∞)

```mermaid
flowchart LR
    App --> Router
    Router --> OldShard
    Router --> NewShard

    OldShard -- CDC --> Kafka --> Migrator
    Migrator --> NewShard

    Router -. switch .-> NewShard
```

---

# üöÄ 10. –ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ

–ò—Ç–æ–≥:

* rebalancing ‚Äî —Å–∞–º–∞—è —Å–ª–æ–∂–Ω–∞—è —á–∞—Å—Ç—å —à–∞—Ä–¥–∏—Ä–æ–≤–∞–Ω–∏—è
* —ç—Ç–æ –≤—Å–µ–≥–¥–∞ –º–Ω–æ–≥–æ—ç—Ç–∞–ø–Ω—ã–π –ø—Ä–æ—Ü–µ—Å—Å
* —Ä–µ—à–µ–Ω–∏–µ ‚Äî —Å–º–µ—Å—å routing, CDC, backfill, –º–∏–≥—Ä–∞—Ç–æ—Ä–æ–≤
* –µ—Å–ª–∏ –ø—Ä–∞–≤–∏–ª—å–Ω–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ ‚Üí –º–æ–∂–Ω–æ –±–µ–∑ –¥–∞—É–Ω—Ç–∞–π–º–∞ –º–∏–≥—Ä–∏—Ä–æ–≤–∞—Ç—å —Ç–µ—Ä–∞–±–∞–π—Ç—ã

–ú–æ—Å—Ç–∏–∫:

> ‚Äú–°–ª–µ–¥—É—é—â–∞—è —Ç–µ–º–∞ ‚Äî —Ä–µ–∞–ª—å–Ω—ã–µ –∏–Ω—Ü–∏–¥–µ–Ω—Ç—ã –±–æ–ª—å—à–∏—Ö –∫–æ–º–ø–∞–Ω–∏–π –∏ –∏—Ö –º–∏–≥—Ä–∞—Ü–∏–∏. –ö–∞–∫ Amazon, LinkedIn, Uber, TikTok –¥–µ–ª–∞–ª–∏ –æ–Ω–ª–∞–π–Ω-–ø–µ—Ä–µ–Ω–æ—Å—ã –¥–∞–Ω–Ω—ã—Ö –∏ –Ω–µ —É—Ä–æ–Ω–∏–ª–∏ –≤—Å—ë‚Äù.

