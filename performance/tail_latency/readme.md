# –í–í–ï–î–ï–ù–ò–ï (2‚Äì3 –º–∏–Ω—É—Ç—ã)

–ü—Ä–µ–¥—Å—Ç–∞–≤—å—Ç–µ —Å–∏—Ç—É–∞—Ü–∏—é. –í–∞—à —Å–µ—Ä–≤–∏—Å —Ä–∞–±–æ—Ç–∞–µ—Ç –±—ã—Å—Ç—Ä–æ, –∫—Ä–∞—Å–∏–≤–æ, —É–≤–µ—Ä–µ–Ω–Ω–æ. –õ–æ–≥–∏ —á–∏—Å—Ç—ã–µ, –≥—Ä–∞—Ñ–∏–∫–∏ —Ä–æ–≤–Ω—ã–µ.
–ò –≤–¥—Ä—É–≥ –æ–¥–∏–Ω –∑–∞–ø—Ä–æ—Å —Ä–µ—à–∞–µ—Ç, —á—Ç–æ –ø–æ—Ä–∞ –≤—ã–±—Ä–æ—Å–∏—Ç—å –≤–∞—Å –∏–∑ –∑–æ–Ω—ã –∫–æ–º—Ñ–æ—Ä—Ç–∞.

–í—Å–µ –æ—Å—Ç–∞–ª—å–Ω—ã–µ 999 –∑–∞–ø—Ä–æ—Å–æ–≤ –æ—Ç—Ä–∞–±–æ—Ç–∞–ª–∏ –∑–∞ 20‚Äì30 –º–∏–ª–ª–∏—Å–µ–∫—É–Ω–¥.
–û–¥–∏–Ω ‚Äî –∑–∞ 2 —Å–µ–∫—É–Ω–¥—ã.

WE ARE IMPATIENT PEOPLE -> money!

–ö—Ç–æ-—Ç–æ —Å–∫–∞–∂–µ—Ç: ¬´–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∂–µ –Ω–æ—Ä–º–∞–ª—å–Ω–∞—è, —á—Ç–æ —Ç–∞–∫–æ–≥–æ?¬ª
–ù—É –¥–∞, —Å—Ä–µ–¥–Ω–µ–µ –≤—Ä–µ–º—è –æ—Ç–≤–µ—Ç–∞ –æ—Ç–ª–∏—á–Ω—ã–π. p50 –æ—Ç–ª–∏—á–Ω—ã–π. –ê –≤–æ—Ç **p99** –≤–Ω–µ–∑–∞–ø–Ω–æ –∂–∏–≤—ë—Ç —Å–≤–æ–µ–π —Ç—ë–º–Ω–æ–π –∂–∏–∑–Ω—å—é.

–ò –≤–æ—Ç —ç—Ç–∞ –æ–¥–Ω–∞ —Å–µ–∫—É–Ω–¥–∞ ‚Äî —ç—Ç–æ –Ω–µ –±–∞–≥. –≠—Ç–æ –Ω–µ ‚Äú—Ä–µ–¥–∫–∏–π —Å–ª—É—á–∞–π‚Äù.
–≠—Ç–æ –Ω–æ—Ä–º–∞–ª—å–Ω–∞—è —Ä–µ–∞–ª—å–Ω–æ—Å—Ç—å –±–æ–ª—å—à–∏—Ö —Å–∏—Å—Ç–µ–º.

–ß–µ–º –±–æ–ª—å—à–µ —Å–∏—Å—Ç–µ–º–∞, —Ç–µ–º –¥–ª–∏–Ω–Ω–µ–µ —Ö–≤–æ—Å—Ç.
–ò —Ç–µ–º –±–æ–ª—å—à–µ –ø—Ä–æ–±–ª–µ–º –æ–Ω –ø—Ä–∏–Ω–æ—Å–∏—Ç:

* –ø–æ—Ç–µ—Ä—è–Ω–Ω—ã–µ –∫–æ—Ä–∑–∏–Ω—ã
* —Ç–∞–π–º–∞—É—Ç—ã
* –ª–∞–≤–∏–Ω—ã —Ä–µ—Ç—Ä–∞–µ–≤
* –≤–Ω–µ–∑–∞–ø–Ω—ã–µ –ø–∏–∫–∏ –Ω–∞–≥—Ä—É–∑–∫–∏
* —Ü–µ–ø–æ—á–∫–∏ –¥–µ–≥—Ä–∞–¥–∞—Ü–∏–π –≤ –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–∞—Ö

–ú—ã —ç—Ç–æ –Ω–∞–∑—ã–≤–∞–µ–º **tail latency** ‚Äî –∑–∞–¥–µ—Ä–∂–∫–∞ –Ω–∞ –∫—Ä–∞—é —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è.

–ß—Ç–æ–±—ã –∑–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞—Ç—å —Ç–µ—Ä–º–∏–Ω—ã ‚Äî –≤–æ—Ç –ø—Ä–æ—Å—Ç–æ–π –≥—Ä–∞—Ñ–∏–∫:

```mermaid
graph LR
A[p50<br/>–ù–æ—Ä–º–∞–ª—å–Ω–∞—è, –æ–∂–∏–¥–∞–µ–º–∞—è –ª–∞—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å]:::normal --> B[p95<br/>—Ä–µ–¥–∫–∏–µ –º–µ–¥–ª–µ–Ω–Ω—ã–µ –æ—Ç–≤–µ—Ç—ã]:::warn --> C[p99<br/>—Ö–≤–æ—Å—Ç —Å–∏—Å—Ç–µ–º—ã]:::bad --> D[p99.9<br/>–∞–¥—Å–∫–∞—è –∑–æ–Ω–∞]:::hell
classDef normal fill:#b5e8b0,stroke:#333,stroke-width:1px;
classDef warn fill:#fff3a2,stroke:#333,stroke-width:1px;
classDef bad fill:#f5c3c3,stroke:#333,stroke-width:1px;
classDef hell fill:#ff8b8b,stroke:#333,stroke-width:1px;
```

–°—Ä–µ–¥–Ω–µ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –∑–¥–µ—Å—å –ø–æ—á—Ç–∏ –Ω–∏—á–µ–≥–æ –Ω–µ –æ—Ç—Ä–∞–∂–∞–µ—Ç.
–û–¥–Ω–∞ –ø–∞—É–∑–∞ –Ω–∞ —Å–µ–∫—É–Ω–¥—É ¬´—Å—ä–µ–¥–∞–µ—Ç¬ª —Ç—ã—Å—è—á–∏ –±—ã—Å—Ç—Ä—ã—Ö –æ—Ç–≤–µ—Ç–æ–≤.

–í —ç—Ç–æ–º –≤–∏–¥–µ–æ –º—ã —Ä–∞–∑–±–µ—Ä—ë–º –Ω–µ —Ç–µ–æ—Ä–∏—é, –∞ –Ω–∞—Å—Ç–æ—è—â—É—é –ø—Ä–∞–∫—Ç–∏–∫—É ‚Äî
–æ—Ç–∫—É–¥–∞ –±–µ—Ä—ë—Ç—Å—è —Ö–≤–æ—Å—Ç, –ø–æ—á–µ–º—É –æ–Ω —Ä–∞—Å—Ç—ë—Ç, –∏ —á—Ç–æ —Å —ç—Ç–∏–º —Ä–µ–∞–ª—å–Ω–æ –¥–µ–ª–∞—é—Ç –≤ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ.

---

## üìä –ë–õ–û–ö 1: –ü–†–û–ë–õ–ï–ú–ê (10‚Äì12 –º–∏–Ω—É—Ç)

---

## 1.1 –ß—Ç–æ —Ç–∞–∫–æ–µ tail latency —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏

Tail latency ‚Äî —ç—Ç–æ –ø–æ–≤–µ–¥–µ–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã **–Ω–∞ –∫—Ä–∞—é —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –∑–∞–¥–µ—Ä–∂–µ–∫**.
–≠—Ç–æ –Ω–µ ¬´–º–µ–¥–ª–µ–Ω–Ω—ã–π –∑–∞–ø—Ä–æ—Å¬ª. –≠—Ç–æ —Ü–µ–ª–∞—è –∑–æ–Ω–∞ –∞–¥—Å–∫–æ–π –∂–∏–∑–Ω–∏.

–û—Å–Ω–æ–≤–Ω—ã–µ –º–µ—Ç—Ä–∏–∫–∏:

* **p95** ‚Äî 5% —Å–∞–º—ã—Ö –º–µ–¥–ª–µ–Ω–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤
* **p99** ‚Äî 1% –º–µ–¥–ª–µ–Ω–Ω–µ–π—à–∏—Ö
* **p999** ‚Äî 0.1% –∑–∞–ø—Ä–æ—Å–æ–≤, –∫–æ—Ç–æ—Ä—ã–µ –æ–±—ã—á–Ω–æ –ª–æ–º–∞—é—Ç –≤–µ—Å—å –ø—Ä–æ–¥–∞–∫—à–µ–Ω

–ü–æ—á–µ–º—É —Å—Ä–µ–¥–Ω–µ–µ –±–µ—Å—Å–º—ã—Å–ª–µ–Ω–Ω–æ:

* –ï—Å–ª–∏ 999 –∑–∞–ø—Ä–æ—Å–æ–≤ –≤—ã–ø–æ–ª–Ω–∏–ª–∏—Å—å –∑–∞ 20ms
* –ò 1 –∑–∞–ø—Ä–æ—Å ‚Äî –∑–∞ 2000ms
* –°—Ä–µ–¥–Ω–µ–µ ‚âà **18ms**

–ü–æ —Å—Ä–µ–¥–Ω–µ–º—É –≤—ã –≤—ã–≥–ª—è–¥–∏—Ç–µ –∫–∞–∫ –±–æ–≥ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏,
–∞ —Ä–µ–∞–ª—å–Ω—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å ‚Äî –∫–∞–∫ –∞–ª—å—Ñ–∞-—Ç–µ—Å—Ç–µ—Ä.

---

### 1.2 The Tail at Scale (—Ö–≤–æ—Å—Ç —Ä–∞—Å—Ç—ë—Ç —ç–∫—Å–ø–æ–Ω–µ–Ω—Ü–∏–∞–ª—å–Ω–æ)

–≠—Ç–æ —Ç–∞ —á–∞—Å—Ç—å, –∫–æ—Ç–æ—Ä—É—é **–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –ø–æ–∫–∞–∑–∞—Ç—å –≤–∏–∑—É–∞–ª—å–Ω–æ**, –∏–Ω–∞—á–µ –ª—é–¥–∏ –Ω–µ–¥–æ–ø–æ–Ω–∏–º–∞—é—Ç.

–ï—Å–ª–∏ —É –≤–∞—Å:

* API Gateway
* Service A
* Service B
* Database
* Redis
* gRPC external

–ò –≤ –∫–∞–∂–¥–æ–º p99 = 200ms, —Ç–æ:

```
–æ–±—â–∏–π p99 = 200ms ^ N
```

N = –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –≤—ã–∑–æ–≤–æ–≤ –≤ —Ü–µ–ø–æ—á–∫–µ.

–ù–µ –±—É–∫–≤–∞–ª—å–Ω–æ –≤ –º–∞—Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–æ–º —Å–º—ã—Å–ª–µ, –Ω–æ **—ç—Ñ—Ñ–µ–∫—Ç —ç–∫—Å–ø–æ–Ω–µ–Ω—Ç—ã** —Ä–µ–∞–ª—å–Ω—ã–π.

–í–æ—Ç –¥–∏–∞–≥—Ä–∞–º–º–∞:

```mermaid
sequenceDiagram
participant Client
participant API
participant ServiceA
participant ServiceB
participant DB

Client->>API: –ó–∞–ø—Ä–æ—Å
API->>ServiceA: –∑–∞–ø—Ä–æ—Å
ServiceA->>ServiceB: –∑–∞–ø—Ä–æ—Å
ServiceB->>DB: SELECT
DB-->>ServiceB: –æ—Ç–≤–µ—Ç (p99 = 200ms)
ServiceB-->>ServiceA: –æ—Ç–≤–µ—Ç (+ 200ms)
ServiceA-->>API: –æ—Ç–≤–µ—Ç (+ 200ms)
API-->>Client: –∏—Ç–æ–≥ (+ 200ms)
```

–ö–∞–∂–¥—ã–π ‚Äú–ø–æ—á—Ç–∏ –±—ã—Å—Ç—Ä—ã–π‚Äù —Å–µ—Ä–≤–∏—Å –¥–æ–±–∞–≤–ª—è–µ—Ç –∫ —Ö–≤–æ—Å—Ç—É.
–ò –≤ –∏—Ç–æ–≥–µ p99 –ø—Ä–µ–≤—Ä–∞—â–∞–µ—Ç—Å—è –≤ —Å–µ–∫—É–Ω–¥—ã, –∞ —Ç–æ –∏ –º–∏–Ω—É—Ç—ã.

---

## 1.3 –û—Ç–∫—É–¥–∞ –±–µ—Ä—É—Ç—Å—è —Ö–≤–æ—Å—Ç—ã (—Ç–æ–ª—å–∫–æ –ø—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–∏—á–∏–Ω—ã)

### –ê–ø–ø–∞—Ä–∞—Ç–Ω—ã–µ

* GC —Å—Ç–æ–ø—ã (–≤ JVM/Go)
* CPU preemption
* I/O spikes (¬´–¥–∏—Å–∫ –≤–Ω–µ–∑–∞–ø–Ω–æ —Ä–µ—à–∏–ª –ø–æ–¥—É–º–∞—Ç—å¬ª)
* Memory paging
* NUMA –ø–µ—Ä–µ–∫–æ—Å—ã

–ï—Å–ª–∏ —Ç—ã –Ω–∞ –æ–±–ª–∞–∫–µ, —Ö–≤–æ—Å—Ç ‚Äî —ç—Ç–æ –Ω–µ –±–∞–≥, —ç—Ç–æ –ø–ª–∞–Ω:

> ‚Äú–°–æ—Å–µ–¥ –∂—Ä—ë—Ç CPU ‚Üí —Ç–≤–æ–π pod —Ç–æ—Ä–º–æ–∑–∏—Ç‚Äù.

### –°–µ—Ç–µ–≤—ã–µ

* –ø–µ—Ä–µ–≥—Ä—É–∑–∫–∞ —Ä–æ—É—Ç–µ—Ä–∞
* packet loss ‚Üí TCP retransmit
* –Ω–µ—Ä–∞–≤–Ω–æ–º–µ—Ä–Ω–∞—è —Ç–æ–ø–æ–ª–æ–≥–∏—è –≤ DC (east-west/cross-rack)

### –ü—Ä–æ–≥—Ä–∞–º–º–Ω—ã–µ

* –≥–æ—Ä—è—á–∏–µ –∫–ª—é—á–∏ –≤ Redis
* –≥–ª–æ–±–∞–ª—å–Ω—ã–µ lock-–∏
* –±–æ–ª—å—à–∏–µ JSON-—Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏–∏
* —Ç—è–∂–µ–ª—ã–µ shard'—ã

–°–∏–º–ø–∞—Ç–∏—á–Ω–∞—è –¥–∏–∞–≥—Ä–∞–º–º–∞ ‚Äú–æ—Ç–∫—É–¥–∞ –±–µ—Ä—ë—Ç—Å—è –∑–∞–¥–µ—Ä–∂–∫–∞‚Äù:

```mermaid
graph TD
A[–ó–∞–ø—Ä–æ—Å] --> B[–ö–æ–¥]
B --> C[Lock-–∏ / —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è]
C --> D[–°–µ—Ç—å]
D --> E[–°—Ç–æ—Ä–æ–Ω–Ω–∏–µ —Å–µ—Ä–≤–∏—Å—ã]
E --> F[–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö]
```

–õ—é–±–æ–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç –º–æ–∂–µ—Ç —Å–æ–∑–¥–∞—Ç—å —Ö–≤–æ—Å—Ç.

---

## 1.4 –ö–∞—Å–∫–∞–¥–Ω—ã–µ —ç—Ñ—Ñ–µ–∫—Ç—ã (–≤—Å—ë –ª–æ–º–∞–µ—Ç—Å—è –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ)

–í–æ—Ç –≥–¥–µ –Ω–∞—Å—Ç–æ—è—â–∏–π –∞–¥ –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è.

### 1) –û—á–µ—Ä–µ–¥–∏ —Ä–∞—Å—Ç—É—Ç ‚Üí –∑–∞–¥–µ—Ä–∂–∫–∏ —Ä–∞—Å—Ç—É—Ç

Little‚Äôs Law:

```
W = L / Œª
```

```
Latency = Concurrency / Throughput
```

–ü—Ä–∏–º–µ—Ä:

* concurrency = 3000
* throughput = 1000 RPS

latency = 3 —Å–µ–∫—É–Ω–¥—ã.


–ï—Å–ª–∏ —É —Ç–µ–±—è —á—É—Ç—å-—á—É—Ç—å –≤—ã—Ä–æ—Å–ª–æ L (–¥–ª–∏–Ω–∞ –æ—á–µ—Ä–µ–¥–∏) ‚Äî –∑–∞–¥–µ—Ä–∂–∫–∞ —É–ª–µ—Ç–∞–µ—Ç.

### 2) –¢–∞–π–º–∞—É—Ç ‚Üí —Ä–µ—Ç—Ä–∞–π ‚Üí –ª–∞–≤–∏–Ω–∞

–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π –∫–ª–∏–µ–Ω—Ç —Ä–µ—Ç—Ä–∞–∏—Ç
–≥–µ–π—Ç–≤–µ–π —Ä–µ—Ç—Ä–∞–∏—Ç
PHP —Ä–µ—Ç—Ä–∞–∏—Ç
–≤—Å—ë —Ä–µ—Ç—Ä–∞–∏—Ç

–ò –æ–¥–∏–Ω —Ö–≤–æ—Å—Ç–æ–≤–æ–π –∑–∞–ø—Ä–æ—Å –ø—Ä–µ–≤—Ä–∞—â–∞–µ—Ç—Å—è –≤:

> RETRY STORM

### 3) Cache-miss avalanche

–µ—Å–ª–∏ –∫–ª—é—á –≥–æ—Ä—è—á–∏–π ‚Üí TTL –∏—Å—Ç—ë–∫ ‚Üí 5000 –∑–∞–ø—Ä–æ—Å–æ–≤ –∏–¥—É—Ç –≤ –±–∞–∑—É ‚Üí –±–∞–∑–∞ —É–º–∏—Ä–∞–µ—Ç ‚Üí API —É–º–∏—Ä–∞–µ—Ç ‚Üí Redis —É–º–∏—Ä–∞–µ—Ç ‚Üí –≤—Å—ë

### 4) Load balancer —Ä–∞—Å–ø—Ä–µ–¥–µ–ª—è–µ—Ç –±–æ–ª—å —Ä–∞–≤–Ω–æ–º–µ—Ä–Ω–æ

–û–Ω –Ω–µ ‚Äú–ª–µ—á–∏—Ç‚Äù —Ö–≤–æ—Å—Ç—ã ‚Äî –æ–Ω –∏—Ö —Ä–∞–∑–º–∞–∑—ã–≤–∞–µ—Ç –ø–æ –≤—Å–µ–º –∏–Ω—Å—Ç–∞–Ω—Å–∞–º,
–¥–µ–ª–∞—è —Ö–≤–æ—Å—Ç **—Å–∏—Å—Ç–µ–º–Ω—ã–º**, –∞ –Ω–µ –ª–æ–∫–∞–ª—å–Ω—ã–º.

–í–æ—Ç –¥–∏–∞–≥—Ä–∞–º–º–∞:

```mermaid
sequenceDiagram
participant Client
participant LB
participant S1
participant S2
participant S3

Client->>LB: –º–Ω–æ–≥–æ –∑–∞–ø—Ä–æ—Å–æ–≤
LB->>S1: —á–∞—Å—Ç—å –∑–∞–ø—Ä–æ—Å–æ–≤ (–æ—á–µ—Ä–µ–¥—å ‚Üë)
LB->>S2: —á–∞—Å—Ç—å –∑–∞–ø—Ä–æ—Å–æ–≤ (–æ—á–µ—Ä–µ–¥—å ‚Üë)
LB->>S3: —á–∞—Å—Ç—å –∑–∞–ø—Ä–æ—Å–æ–≤ (–æ—á–µ—Ä–µ–¥—å ‚Üë)

Note over S1,S3: –û–¥–∏–Ω –º–µ–¥–ª–µ–Ω–Ω—ã–π –∏–Ω—Å—Ç–∞–Ω—Å ‚Üí –≤–µ—Å—å –∫–ª–∞—Å—Ç–µ—Ä —Ç–æ—Ä–º–æ–∑–∏—Ç
```

---

# üõ† –ë–õ–û–ö 2: –†–ï–®–ï–ù–ò–Ø TAIL LATENCY (15‚Äì18 –º–∏–Ω—É—Ç)

> –ü—Ä–µ–∂–¥–µ —á–µ–º –±–µ–∂–∞—Ç—å –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å, –Ω–∞–¥–æ –ø—Ä–∏–Ω—è—Ç—å –ø—Ä–æ—Å—Ç—É—é –º—ã—Å–ª—å:
> **–•–≤–æ—Å—Ç—ã –Ω–µ–∏–∑–±–µ–∂–Ω—ã.**
> –£–º–Ω—ã–µ —Å–∏—Å—Ç–µ–º—ã –Ω–µ ‚Äú–∏—Å–∫–æ—Ä–µ–Ω—è—é—Ç‚Äù tail latency, –æ–Ω–∏ **–∂–∏–≤—É—Ç —Å –Ω–∏–º**.

–ï—Å—Ç—å –¥–≤–∞ —Ç–∏–ø–∞ —Ç–µ—Ö–Ω–∏–∫:

1. **–£–º–µ–Ω—å—à–µ–Ω–∏–µ —Ö–≤–æ—Å—Ç–∞** ‚Äî —Å–¥–µ–ª–∞—Ç—å —Ç–∞–∫, —á—Ç–æ–±—ã –º–µ–¥–ª–µ–Ω–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤ –±—ã–ª–æ –º–µ–Ω—å—à–µ
2. **–ú–∞—Å–∫–∏—Ä–æ–≤–∫–∞/–æ–±—Ö–æ–¥ —Ö–≤–æ—Å—Ç–∞** ‚Äî —Å–¥–µ–ª–∞—Ç—å —Ç–∞–∫, —á—Ç–æ–±—ã –º–µ–¥–ª–µ–Ω–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã –Ω–µ –ª–æ–º–∞–ª–∏ –≤—Å—ë –ø–æ–¥—Ä—è–¥

Google –ø—Ä—è–º–æ —Ç–∞–∫ –¥–µ–ª–∏—Ç –ø–æ–¥—Ö–æ–¥—ã: short-term –∏ long-term.

---

# üîπ 2.1. SHORT-TERM: —Ç–µ—Ö–Ω–∏–∫–∏ —É–º–µ–Ω—å—à–µ–Ω–∏—è —Ö–≤–æ—Å—Ç–∞

–≠—Ç–æ —Ç–æ, —á—Ç–æ –º–æ–∂–Ω–æ –≤–Ω–µ–¥—Ä–∏—Ç—å **–±—ã—Å—Ç—Ä–æ**, –∏ –æ–Ω–æ –Ω–∞—á–∏–Ω–∞–µ—Ç —Å—Ä–∞–∑—É —Å–Ω–∏–∂–∞—Ç—å p99/p999.

---

## ‚úî Hedged Requests

–≠—Ç–æ —Ä–µ—à–µ–Ω–∏–µ, –∫–æ—Ç–æ—Ä–æ–µ Google –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –ø—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏ –≤ –∫–∞–∂–¥–æ–º —Å–µ—Ä–≤–∏—Å–µ.
–î–∞, –≤ PHP –æ–Ω–æ —Ç–æ–∂–µ —Ä–∞–±–æ—Ç–∞–µ—Ç (–µ—Å–ª–∏ —Ç—ã –Ω–µ –∂–∏–≤—ë—à—å –≤ –º–∏—Ä–µ —Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã—Ö –∞–¥—Å–∫–∏—Ö –∑–∞–ø—Ä–æ—Å–æ–≤, –Ω–æ —É —Ç–µ–±—è –µ—Å—Ç—å –æ—á–µ—Ä–µ–¥–∏ –∏–ª–∏ async-–≤–æ—Ä–∫–µ—Ä—ã).

### –°—É—Ç—å

–û—Ç–ø—Ä–∞–≤–ª—è–µ–º **–≤—Ç–æ—Ä–æ–π –∑–∞–ø—Ä–æ—Å** —á–µ—Ä–µ–∑ –∑–∞–¥–µ—Ä–∂–∫—É, —Ä–∞–≤–Ω—É—é p95.
–ü–µ—Ä–≤—ã–π, –∫—Ç–æ –æ—Ç–≤–µ—Ç–∏—Ç ‚Äî –≤—ã–∏–≥—Ä–∞–ª.

–í–æ—Ç –ø—Ä–∏–º–µ—Ä:

```mermaid
sequenceDiagram
participant Client
participant ServerA
participant ServerB

Client->>ServerA: –ó–∞–ø—Ä–æ—Å
Client-->>Client: –ñ–¥—ë–º p95 (–Ω–∞–ø—Ä–∏–º–µ—Ä 80ms)
Client->>ServerB: –î—É–±–ª–∏–∫–∞—Ç –∑–∞–ø—Ä–æ—Å–∞

ServerB-->>Client: –ë—ã—Å—Ç—Ä—ã–π –æ—Ç–≤–µ—Ç (90ms)
Client-->>ServerA: –û—Ç–º–µ–Ω–∞ –∏–ª–∏ –∏–≥–Ω–æ—Ä
```

### –ü–æ—á–µ–º—É —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç?

–ü–æ—Ç–æ–º—É —á—Ç–æ ‚Äú—Ö–≤–æ—Å—Ç–æ–≤–æ–π‚Äù —Å–µ—Ä–≤–µ—Ä ‚Äî —ç—Ç–æ **—Ä–µ–¥–∫–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ**.
–î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–∞ –¥–∞—ë—Ç —à–∞–Ω—Å –ø–æ–ø–∞—Å—Ç—å –Ω–∞ –±—ã—Å—Ç—Ä—ã–π –∏–Ω—Å—Ç–∞–Ω—Å.

### –ü–ª—é—Å—ã

* p99 –ø–∞–¥–∞–µ—Ç –≤ **—Ä–∞–∑—ã**
* p999 –ø–∞–¥–∞–µ—Ç –≤ **–¥–µ—Å—è—Ç–∫–∏ —Ä–∞–∑**
* –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –Ω–∞–≥—Ä—É–∑–∫–∞ 2‚Äì5%
* –ø–æ—á—Ç–∏ –±–µ—Å–ø–ª–∞—Ç–Ω–æ –ø–æ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

### –ú–∏–Ω—É—Å—ã

* –æ–ø–µ—Ä–∞—Ü–∏–∏ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å *idempotent*
* –Ω–µ–ª—å–∑—è –¥–µ–ª–∞—Ç—å —Ç–∞–∫ –¥–ª—è –æ–ø–µ—Ä–∞—Ü–∏–π —Å –ø–æ–±–æ—á–Ω—ã–º–∏ —ç—Ñ—Ñ–µ–∫—Ç–∞–º–∏
* PHP-–∫–æ–¥ –Ω–∞ —Å—Ç–æ—Ä–æ–Ω–µ —Å–µ—Ä–≤–µ—Ä–∞ –¥–æ–ª–∂–µ–Ω —É–º–µ—Ç—å –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å –¥—É–±–ª–∏–∫–∞—Ç—ã

### –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π PHP –ø—Ä–∏–º–µ—Ä (Symfony + HTTP Client)

```php
public function hedgedRequest(HttpClientInterface $http, string $url)
{
    $primary = $http->request('GET', $url);

    // –ñ–¥–µ–º p95 ‚Äì –Ω–∞–ø—Ä–∏–º–µ—Ä 80 –º—Å
    usleep(80_000);

    $secondary = $http->request('GET', $url);

    // –ü–µ—Ä–≤—ã–º –ø—Ä–∏—à—ë–ª ‚Äî –ø–æ–±–µ–¥–∏–ª
    $responses = [$primary, $secondary];

    foreach ($responses as $res) {
        try {
            return $res->getContent();
        } catch (\Throwable $e) {
            // –∏–≥–Ω–æ—Ä–∏—Ä—É–µ–º
        }
    }

    throw new \RuntimeException('Both hedged requests failed');
}
```

–ü–æ–Ω—è—Ç–Ω–æ, –¥–∞?
–ù–∏—á–µ–≥–æ –º–∞–≥–∏—á–µ—Å–∫–æ–≥–æ ‚Äî –ø—Ä–æ—Å—Ç–æ —Å—Ç—Ä–∞—Ö–æ–≤–∫–∞.

---

# ‚úî Tied Requests (–°–≤—è–∑–∞–Ω–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã)

–≠—Ç–æ —Å–ª–µ–¥—É—é—â–∏–π —É—Ä–æ–≤–µ–Ω—å –ø—Ä–µ–≤–æ—Å—Ö–æ–¥—Å—Ç–≤–∞ –Ω–∞–¥ hedging.
–¢–µ—Ö–Ω–∏–∫–∞ –º–æ—â–Ω–∞—è, –Ω–æ —Ç—Ä–µ–±—É–µ—Ç –ø–æ–¥–¥–µ—Ä–∂–∫–∏ –Ω–∞ —Å—Ç–æ—Ä–æ–Ω–µ —Å–µ—Ä–≤–µ—Ä–æ–≤.

### –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç:

1. –ö–ª–∏–µ–Ω—Ç –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –∑–∞–ø—Ä–æ—Å –Ω–∞ —Å–µ—Ä–≤–µ—Ä **A**
2. –ß–µ—Ä–µ–∑ ~2 RTT (–æ–±—ã—á–Ω–æ ‚â§1ms –≤ –¥–∞—Ç–∞—Ü–µ–Ω—Ç—Ä–µ) –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –∫–æ–ø–∏—é –Ω–∞ **B**
3. –°–µ—Ä–≤–µ—Ä **A**, –Ω–∞—á–∞–≤ –æ–±—Ä–∞–±–æ—Ç–∫—É, –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç ‚Äúcancel‚Äù –Ω–∞ **B**
4. –ï—Å–ª–∏ **B** –µ—â—ë –Ω–µ –Ω–∞—á–∞–ª –æ–±—Ä–∞–±–æ—Ç–∫—É ‚Üí –æ–Ω –æ—Ç–º–µ–Ω—è–µ—Ç
5. –ï—Å–ª–∏ –Ω–∞—á–∞–ª ‚Üí –ø–æ–Ω–∏–∂–∞–µ—Ç –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç –∏–ª–∏ –ø—Ä–µ–∫—Ä–∞—â–∞–µ—Ç

### –î–∏–∞–≥—Ä–∞–º–º–∞

```mermaid
sequenceDiagram
participant Client
participant A
participant B

Client->>A: –ó–∞–ø—Ä–æ—Å (id=123)
Client-->>Client: –ó–∞–¥–µ—Ä–∂–∫–∞ 1‚Äì2 RTT
Client->>B: –ó–∞–ø—Ä–æ—Å (id=123, peer=A)

A-->>B: CANCEL 123
B-->>A: CANCELLED
```

### –í —á—ë–º —Å–∏–ª–∞?

* –ø–æ—á—Ç–∏ –Ω–∏–∫–æ–≥–¥–∞ **–æ–±–∞** —Å–µ—Ä–≤–µ—Ä–∞ –Ω–µ –Ω–∞—á–∏–Ω–∞—é—Ç —Ä–∞–±–æ—Ç—É
* —Ö–≤–æ—Å—Ç–æ–≤—ã–µ –∑–∞–¥–µ—Ä–∂–∫–∏ –≥–ª—É—à–∞—Ç—Å—è —É–∂–µ –Ω–∞ —É—Ä–æ–≤–Ω–µ –æ—á–µ—Ä–µ–¥–µ–π
* –Ω–µ –Ω—É–∂–Ω–æ –¥—É–±–ª–∏—Ä–æ–≤–∞—Ç—å –¥–æ—Ä–æ–≥–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–∏

### –ü–ª—é—Å—ã

* –ú–µ–Ω—å—à–µ –Ω–∞–≥—Ä—É–∑–∫–∏, —á–µ–º —É hedging
* –°–∏–ª—å–Ω–µ–µ —É–º–µ–Ω—å—à–∞–µ—Ç p999
* –ò–¥–µ–∞–ª—å–Ω–æ –¥–ª—è –Ω–µ–≤–µ—Ä–æ—è—Ç–Ω–æ –Ω–∞–≥—Ä—É–∂–µ–Ω–Ω—ã—Ö API

### –ú–∏–Ω—É—Å—ã

* —Å–ª–æ–∂–Ω–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –≤ —á–∏—Å—Ç–æ–º PHP
* –Ω—É–∂–Ω–∞ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ü–∏—è –º–µ–∂–¥—É –≤–æ—Ä–∫–µ—Ä–∞–º–∏
* –Ω—É–∂–µ–Ω –±—ã—Å—Ç—Ä—ã–π –º–µ–∂—Å–µ—Ä–≤–µ—Ä–Ω—ã–π –∫–∞–Ω–∞–ª

–≠—Ç–æ —É–∂–µ —É—Ä–æ–≤–µ–Ω—å ‚Äú–∫–ª–∞—Å—Ç–µ—Ä–Ω–æ–≥–æ –æ–∫—Ä—É–∂–µ–Ω–∏—è‚Äù, –Ω–æ –µ—Å–ª–∏ —É —Ç–µ–±—è –±–æ–ª—å—à–∞—è —Å–∏—Å—Ç–µ–º–∞ ‚Äî –º–∞—Å—Ç—Ö–µ–≤.

---

# ‚úî Request Coalescing

–≠—Ç–æ –ø—Ä–æ—Å—Ç–æ–µ, –Ω–æ –≥–µ–Ω–∏–∞–ª—å–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ.

### –ü—Ä–æ–±–ª–µ–º–∞

–ï—Å–ª–∏ 5000 –∑–∞–ø—Ä–æ—Å–æ–≤ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ —Ö–æ—Ç—è—Ç –æ–¥–Ω–æ –∏ —Ç–æ –∂–µ ‚Äî
–æ–Ω–∏ –∏–¥—É—Ç —Ç–æ–ª–ø–æ–π –≤–Ω–∏–∑, –≤—ã–∑—ã–≤–∞—è:

* k8s queue spike
* Redis hot key
* DB overload

### –†–µ—à–µ–Ω–∏–µ

–ü–µ—Ä–≤—ã–π –∑–∞–ø—Ä–æ—Å ‚Äú–∑–∞–±–∏—Ä–∞–µ—Ç –±–∏–ª–µ—Ç‚Äù –∏ –∏–¥—ë—Ç –≤–Ω–∏–∑.
–û—Å—Ç–∞–ª—å–Ω—ã–µ –∂–¥—É—Ç –∏ –ø–æ–ª—É—á–∞—é—Ç —Ç–æ—Ç –∂–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç.

### –ü—Ä–∏–º–µ—Ä (Symfony Gateway)

```php
$key = 'coalesce:' . md5($url);

if ($result = $cache->get($key)) {
    return $result;
}

$lock = $lockFactory->createLock($key);

if (!$lock->acquire()) {
    // –ö—Ç–æ-—Ç–æ —É–∂–µ –¥–µ–ª–∞–µ—Ç –∑–∞–ø—Ä–æ—Å ‚Äî –ø–æ–¥–æ–∂–¥—ë–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç
    return $cache->get($key, 2.0);
}

try {
    $response = $http->request('GET', $url)->getContent();
    $cache->set($key, $response, 2);
    return $response;
} finally {
    $lock->release();
}
```

### –ü–ª—é—Å—ã

* —Å–ø–∞—Å–∞–µ—Ç Redis –æ—Ç —Å–º–µ—Ä—Ç–∏ –Ω–∞ hot key
* —É–º–µ–Ω—å—à–∞–µ—Ç –Ω–∞–≥—Ä—É–∑–∫—É –Ω–∞ –ë–î
* —Ä–∞–±–æ—Ç–∞–µ—Ç –≤ –ª—é–±–æ–º —è–∑—ã–∫–µ

### –ú–∏–Ω—É—Å—ã

* –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –¥–ª—è —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤
* –¥–æ–±–∞–≤–ª—è–µ—Ç ‚Äú–º–∏–∫—Ä–æ-–∑–∞–¥–µ—Ä–∂–∫—É‚Äù –ø–µ—Ä–≤—ã–º –≤ batch

---

# üîπ 2.2 LONG-TERM: –º–∞—Å–∫–∏—Ä–æ–≤–∫–∞ –∏ –æ–±—Ö–æ–¥ —Ö–≤–æ—Å—Ç–æ–≤

–≠—Ç–æ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ —Ç–µ—Ö–Ω–∏–∫–∏ ‚Äî –Ω–µ ‚Äú—Ñ–∏—á–∏‚Äù, –∞ –ø–æ–¥—Ö–æ–¥—ã.

---

# ‚úî Latency-aware Load Balancing

–û–±—ã—á–Ω—ã–π load balancer:

> —Ä–∞—Å–ø—Ä–µ–¥–µ–ª—è–µ—Ç –∑–∞–ø—Ä–æ—Å—ã ‚Äú—Ä–∞–≤–Ω–æ–º–µ—Ä–Ω–æ‚Äù.

Latency-aware LB:

> –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –º–µ–Ω—å—à–µ –∑–∞–ø—Ä–æ—Å–æ–≤ –Ω–∞ –º–µ–¥–ª–µ–Ω–Ω—ã–µ –∏–Ω—Å—Ç–∞–Ω—Å—ã.

–û–Ω –æ—Ü–µ–Ω–∏–≤–∞–µ—Ç –∏–Ω—Å—Ç–∞–Ω—Å—ã –ø–æ **health score**:

```mermaid
graph LR
A[Latency] --> S[Health Score]
B[Error Rate] --> S
C[Queue Length] --> S
S --> LB[Routing Decision]
```

–ï—Å–ª–∏ –∫–∞–∫–æ–π-—Ç–æ node ‚Äú–±—É–∫—Å—É–µ—Ç‚Äù, LB –µ–≥–æ **–≤—Ä–µ–º–µ–Ω–Ω–æ –∏—Å–∫–ª—é—á–∞–µ—Ç**, –ø–æ—Ç–æ–º –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —á–µ—Ä–µ–∑ exponential backoff.

### –ü–ª—é—Å—ã

* —É–º–µ–Ω—å—à–∞–µ—Ç —Ö–≤–æ—Å—Ç **–±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏—è –∫–æ–¥–∞**
* —Ä–µ–∞–∫—Ü–∏—è –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã–µ —É—Å–ª–æ–≤–∏—è –Ω–∞–≥—Ä—É–∑–∫–∏

### –ú–∏–Ω—É—Å—ã

* –Ω—É–∂–Ω–æ –º–Ω–æ–≥–æ –º–µ—Ç—Ä–∏–∫ (Prometheus + exporters)
* –º–æ–∂–µ—Ç —Å–¥–µ–ª–∞—Ç—å ‚Äú–≥–æ—Ä—è—á–∏–µ —Ç–æ—á–∫–∏‚Äù

---

# ‚úî Deadline Propagation

–ö–æ–≥–¥–∞ —É –∫–ª–∏–µ–Ω—Ç–∞ –µ—Å—Ç—å ‚Äú—Ç–∞–π–º-–±—é–¥–∂–µ—Ç‚Äù, –Ω–æ –Ω–∏–∫—Ç–æ –≤ —Ü–µ–ø–æ—á–∫–µ –æ –Ω—ë–º –Ω–µ –∑–Ω–∞–µ—Ç ‚Äî
—ç—Ç–æ –≥–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ –ø—Ä–∏–≤–æ–¥–∏—Ç –∫ —Ö–≤–æ—Å—Ç–∞–º.

Deadline propagation ‚Äî —ç—Ç–æ:

* –∫–ª–∏–µ–Ω—Ç ‚Üí API: ‚Äú—É –º–µ–Ω—è 200–º—Å –Ω–∞ –æ—Ç–≤–µ—Ç‚Äù
* API ‚Üí —Å–µ—Ä–≤–∏—Å—ã: ‚Äú—É –º–µ–Ω—è –æ—Å—Ç–∞–ª–æ—Å—å 150–º—Å‚Äù
* —Å–µ—Ä–≤–∏—Å—ã ‚Üí –±–∞–∑–∞: ‚Äú—É –º–µ–Ω—è –æ—Å—Ç–∞–ª–æ—Å—å 100–º—Å‚Äù

### –ß—Ç–æ —ç—Ç–æ –¥–∞—ë—Ç?

–ï—Å–ª–∏ deadline –≤—ã—à–µ–ª, —Å–µ—Ä–≤–∏—Å—ã –ø—Ä–µ–∫—Ä–∞—â–∞—é—Ç —Ä–∞–±–æ—Ç—É **—Å—Ä–∞–∑—É**, —ç–∫–æ–Ω–æ–º—è —Ä–µ—Å—É—Ä—Å—ã.

### –ü–ª—é—Å—ã

* –Ω–∏–∫–∞–∫–æ–π –±–µ—Å–∫–æ–Ω—Ç—Ä–æ–ª—å–Ω–æ–π —Ä–∞–±–æ—Ç—ã
* –º–µ–Ω—å—à–µ –Ω–∞–≥—Ä—É–∑–∫–∏
* –º–µ–Ω—å—à–µ cascade failure

–í Symfony —ç—Ç–æ —Ä–µ–∞–ª–∏–∑—É–µ—Ç—Å—è –ø—Ä–æ—Å—Ç–æ: –Ω–∞ –≤—Ö–æ–¥–µ —Ç—ã –ø–∞—Ä—Å–∏—à—å –¥–µ–¥–ª–∞–π–Ω –∏ —Å—á–∏—Ç–∞–µ—à—å ‚Äú—Å–∫–æ–ª—å–∫–æ –æ—Å—Ç–∞–ª–æ—Å—å‚Äù. –ü–µ—Ä–µ–¥ –∫–∞–∂–¥–æ–π –æ–ø–µ—Ä–∞—Ü–∏–µ–π (SQL, Redis, HTTP) —Ç—ã –¥–µ–ª–∞–µ—à—å –∫–æ—Ä–æ—Ç–∫—É—é –ø—Ä–æ–≤–µ—Ä–∫—É:

```php
if ($deadline->isExpired()) throw new DeadlineExceededException();
```

–ò –ø–µ—Ä–µ–¥–∞—ë—à—å –æ—Å—Ç–∞–≤—à–∏–π—Å—è –±—é–¥–∂–µ—Ç –≤ timeout –¥—Ä–∞–π–≤–µ—Ä–∞:

```php
$db->executeQuery($sql, [], ['timeout' => $deadline->remainingMs()/1000]);
```

–ü—Ä–∏ –≤—ã–∑–æ–≤–µ downstream-—Å–µ—Ä–≤–∏—Å–æ–≤ –¥–µ–¥–ª–∞–π–Ω –ø—Ä–æ—Å—Ç–æ –ø—Ä–æ–∫–∏–¥—ã–≤–∞–µ—Ç—Å—è –¥–∞–ª—å—à–µ —Ç–µ–º –∂–µ —Ö–µ–¥–µ—Ä–æ–º:

```php
$http->get($url, [
    'headers' => ['X-Deadline-At' => $deadline->getDeadlineAt()],
    'timeout' => $deadline->remainingMs()/1000,
]);
```

–≠—Ç–æ –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –ø—Ä–æ—Å—Ç–æ–µ –ø—Ä–∞–≤–∏–ª–æ: **–µ—Å–ª–∏ –¥–µ–¥–ª–∞–π–Ω –≤—ã—à–µ–ª ‚Äî —Ä–∞–±–æ—Ç–∞ –ø—Ä–µ–∫—Ä–∞—â–∞–µ—Ç—Å—è –≤–µ–∑–¥–µ**, –Ω–µ —É—Å—É–≥—É–±–ª—è—è —Ö–≤–æ—Å—Ç—ã, –Ω–µ –∑–∞–±–∏–≤–∞—è –±–∞–∑—É –∏ –Ω–µ —Å–æ–∑–¥–∞–≤–∞—è –∫–∞—Å–∫–∞–¥–Ω—ã–µ —Å–±–æ–∏. –°–Ω–∞—Ä—É–∂–∏ –∫–ª–∏–µ–Ω—Ç –ø–æ–ª—É—á–∏—Ç 504 –±—ã—Å—Ç—Ä–µ–µ, –∞ —Å–∏—Å—Ç–µ–º–∞ —Å–æ—Ö—Ä–∞–Ω–∏—Ç —Ä–µ—Å—É—Ä—Å—ã.

---

# ‚úî Priority Queues

–ï—Å–ª–∏ –æ—á–µ—Ä–µ–¥—å –æ–¥–Ω–∞ –¥–ª—è –≤—Å–µ—Ö ‚Äî
—Ö–≤–æ—Å—Ç –æ–¥–Ω–∏–º –º–µ–¥–ª–µ–Ω–Ω—ã–º batch job –ø–æ–ª–æ–∂–∏—Ç –∫—Ä–∏—Ç–∏—á–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏.

–†–µ—à–µ–Ω–∏–µ: —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ –ø–æ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–∞–º.

### –ü—Ä–∏–º–µ—Ä

* HIGH: –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏–µ –∑–∞–∫–∞–∑–∞, –æ–ø–ª–∞—Ç–∞
* MEDIUM: –ø–æ–ª—É—á–µ–Ω–∏–µ –∫–æ—Ä–∑–∏–Ω—ã
* LOW: –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –æ—Ç—á—ë—Ç–æ–≤

### –ü–ª—é—Å—ã

* –≥–∞—Ä–∞–Ω—Ç–∏–∏ –¥–ª—è –≤–∞–∂–Ω–æ–≥–æ –ø—É—Ç–∏
* –ø—Ä–µ–¥—Å–∫–∞–∑—É–µ–º–æ—Å—Ç—å —Ä–∞–±–æ—Ç—ã

### –ú–∏–Ω—É—Å—ã

* —Ä–∏—Å–∫ starvation –Ω–∏–∑–∫–∏—Ö –æ—á–µ—Ä–µ–¥–µ–π

# ‚úî –ö–∞–∫ —Ä–µ–∞–ª—å–Ω–æ –¥–µ–ª–∞—é—Ç—Å—è Priority Queues

–ï—Å—Ç—å **–¥–≤–∞** –ø—Ä–∞–∫—Ç–∏—á–Ω—ã—Ö –≤–∞—Ä–∏–∞–Ω—Ç–∞:

## **–í–∞—Ä–∏–∞–Ω—Ç 1: –ù–µ—Å–∫–æ–ª—å–∫–æ –æ—Ç–¥–µ–ª—å–Ω—ã—Ö –æ—á–µ—Ä–µ–¥–µ–π (—Å–∞–º—ã–π —Ä–∞–±–æ—á–∏–π)**

–¢—ã –ø—Ä–æ—Å—Ç–æ —Å–æ–∑–¥–∞—ë—à—å **3 –æ—á–µ—Ä–µ–¥–∏**:

```
orders.high
orders.medium
orders.low
```

–ò –∑–∞–ø—É—Å–∫–∞–µ—à—å **–æ—Ç–¥–µ–ª—å–Ω—ã–µ –≥—Ä—É–ø–ø—ã –≤–æ—Ä–∫–µ—Ä–æ–≤**:

```
workers-high:   20 —à—Ç—É–∫
workers-medium: 10 —à—Ç—É–∫
workers-low:     2 —à—Ç—É–∫–∏
```

–ò –ø—Ä–∏ —ç—Ç–æ–º gateway/producer —Å–∞–º —Ä–µ—à–∞–µ—Ç –∫—É–¥–∞ –ø–∏—Ö–∞—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ:

```php
$priority = $order->isPayment() ? 'high' : 'medium';
$bus->dispatch($msg, new AmqpStamp("orders.$priority"));
```

### –ü–æ—á–µ–º—É —ç—Ç–æ –ª—É—á—à–∏–π —Å–ø–æ—Å–æ–±:

* —Ç—ã —Å–∞–º –∫–æ–Ω—Ç—Ä–æ–ª–∏—Ä—É–µ—à—å –ø—Ä–æ–ø–æ—Ä—Ü–∏—é —Ä–µ—Å—É—Ä—Å–æ–≤
* –≤—ã—Å–æ–∫–∞—è –æ—á–µ—Ä–µ–¥—å –Ω–µ –±–ª–æ–∫–∏—Ä—É–µ—Ç—Å—è –Ω–∏–∑–∫–∏–º–∏ –∑–∞–¥–∞—á–∞–º–∏
* –Ω–∏–∫–∞–∫–æ–π –º–∞–≥–∏–∏ –±—Ä–æ–∫–µ—Ä–∞, –≤—Å—ë –ø—Ä–æ–∑—Ä–∞—á–Ω–æ

–ò–º–µ–Ω–Ω–æ —Ç–∞–∫ –¥–µ–ª–∞—é—Ç Shopify, Netflix –∏ –ø—Ä–æ—á–∏–µ –≤–∑—Ä–æ—Å–ª—ã–µ —Å–∏—Å—Ç–µ–º—ã.

---

## **–í–∞—Ä–∏–∞–Ω—Ç 2: –ù–∞—Å—Ç–æ—è—â–∏–π AMQP priority (RabbitMQ Priority Queues)**

RabbitMQ *—É–º–µ–µ—Ç* ‚Äú–≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç‚Äù, –Ω–æ –æ–Ω, –º—è–≥–∫–æ –≥–æ–≤–æ—Ä—è, –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω—ã–π.

### –ö–∞–∫ –≤—ã–≥–ª—è–¥–∏—Ç:

1. –°–æ–∑–¥–∞—ë—à—å –æ—á–µ—Ä–µ–¥—å —Å –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–æ–º:

```bash
x-max-priority: 10
```

2. –û—Ç–ø—Ä–∞–≤–ª—è–µ—à—å —Å–æ–æ–±—â–µ–Ω–∏—è —Å —Ä–∞–∑–Ω—ã–º –∑–Ω–∞—á–µ–Ω–∏–µ–º `priority`:

```php
$bus->dispatch(
    $msg,
    new AmqpStamp('queue', AMQP_NOPARAM, ['priority' => 9])
);
```

### –ù–æ –ø—Ä–æ–±–ª–µ–º—ã —Ç–∞–∫–∏–µ:

* –æ—á–µ—Ä–µ–¥—å –≤—Å—ë —Ä–∞–≤–Ω–æ –æ–¥–Ω–∞ ‚Üí **–µ–¥–∏–Ω–∏—á–Ω–∞—è —Ç–æ—á–∫–∞ –æ—Ç–∫–∞–∑–∞**
* –µ—Å–ª–∏ –≤–Ω—É—Ç—Ä–∏ –µ—Å—Ç—å –±–æ–ª—å—à–æ–π LOW message ‚Üí –æ–Ω –≤—Å—ë —Ä–∞–≤–Ω–æ –∑–∞–Ω–∏–º–∞–µ—Ç –ø–∞–º—è—Ç—å
* RabbitMQ —á–∏—Ç–∞–µ—Ç –≤—Å—ë –ø–æ–¥—Ä—è–¥, –Ω–æ **—Å—Ç–∞–≤–∏—Ç high –≤–ø–µ—Ä—ë–¥ —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –≤—ã–±–æ—Ä–µ**, –Ω–µ –ø—Ä–∏ —Ä–∞–∑–º–µ—â–µ–Ω–∏–∏
* –ø—Ä–∏ –±–æ–ª—å—à–æ–º –æ–±—ä—ë–º–µ —Å–æ–æ–±—â–µ–Ω–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç—ã –Ω–∞—á–∏–Ω–∞—é—Ç –≤–µ—Å—Ç–∏ —Å–µ–±—è —Å—Ç—Ä–∞–Ω–Ω–æ (–¥–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Ñ–∞–∫—Ç)

–ö–æ—Ä–æ—á–µ: **—Ä–∞–±–æ—á–∏–π –≤–∞—Ä–∏–∞–Ω—Ç, –Ω–æ —Ö—É–∂–µ —á–µ–º multiple queues**.

---

# ‚úî –ß—Ç–æ –∏—Å–ø–æ–ª—å–∑—É—é—Ç –≤ —Ä–µ–∞–ª—å–Ω—ã—Ö –ø—Ä–æ–¥–∞—Ö (–∫–æ—Ä–æ—Ç–∫–æ–µ —Ä–µ–∑—é–º–µ)

### **–ü—Ä–∞–≤–∏–ª—å–Ω–æ:**

‚úî –Ω–µ—Å–∫–æ–ª—å–∫–æ –æ—á–µ—Ä–µ–¥–µ–π
‚úî –Ω–µ—Å–∫–æ–ª—å–∫–æ –ø—É–ª–æ–≤ –≤–æ—Ä–∫–µ—Ä–æ–≤
‚úî —Ä–∞–∑–Ω—ã–µ –ª–∏–º–∏—Ç—ã –Ω–∞ concurrency
‚úî –æ—Ç–¥–µ–ª—å–Ω—ã–µ dead-letter –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–∞

### **–ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ:**

‚ùå –æ–¥–Ω–∞ –æ—á–µ—Ä–µ–¥—å –Ω–∞ –≤—Å—ë
‚ùå –Ω–∞–¥–µ—è—Ç—å—Å—è, —á—Ç–æ ‚Äú–∞–º–∫–ø-–ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç –≤—Å—ë –ø–æ—á–∏–Ω–∏—Ç‚Äù
‚ùå –Ω–µ –æ–≥—Ä–∞–Ω–∏—á–∏–≤–∞—Ç—å –Ω–∏–∑–∫–æ–ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–Ω—ã–µ –≤–æ—Ä–∫–µ—Ä—ã

---

# ‚úî –ú–∏–Ω–∏-–¥–∏–∞–≥—Ä–∞–º–º–∞ (–∫–∞–∫ —ç—Ç–æ –≤—ã–≥–ª—è–¥–∏—Ç)

```mermaid
flowchart LR

A[API] -->|critical| Q1[orders.high]
A -->|normal| Q2[orders.medium]
A -->|bg| Q3[orders.low]

Q1 --> WH[Workers High (20)]
Q2 --> WM[Workers Medium (10)]
Q3 --> WL[Workers Low (2)]
```

---

–õ–∞–¥–Ω–æ, –≤—Å—Ç–∞–≤–ª—è—é —ç—Ç–æ –≤ —Ç–≤–æ–π –±–ª–æ–∫ —Ç–∞–∫, –±—É–¥—Ç–æ –æ–Ω–æ —Ç–∞–º –∏ –±—ã–ª–æ –∏–∑–Ω–∞—á–∞–ª—å–Ω–æ. –ë–µ–∑ –≤–æ–¥—ã, —Ç–æ–ª—å–∫–æ –ø—Ä–∞–∫—Ç–∏–∫–∞, –∫–∞–∫ —Ç—ã —Ö–æ—Ç–µ–ª.

---

# ‚úî Circuit Breaker

–¢–∏–ø–∏—á–Ω–∞—è —Å–∏—Ç—É–∞—Ü–∏—è:

* –≤–Ω–µ—à–Ω–∏–π —Å–µ—Ä–≤–∏—Å —Ç–æ—Ä–º–æ–∑–∏—Ç
* —Ç–≤–æ–π API –≤–∏—Å–∏—Ç
* —Ä–µ—Ç—Ä–∞–∏ —Ä–∞—Å—Ç—É—Ç
* –≤–µ—Å—å –∫–ª–∞—Å—Ç–µ—Ä —É–º–∏—Ä–∞–µ—Ç

Circuit Breaker –≥–æ–≤–æ—Ä–∏—Ç: **‚Äú–•–≤–∞—Ç–∏—Ç, –º—ã —Ç—É–¥–∞ –±–æ–ª—å—à–µ –Ω–µ —Ö–æ–¥–∏–º‚Äù**, –ø–æ–∫–∞ —Å–µ—Ä–≤–∏—Å –Ω–µ –æ–∂–∏–≤—ë—Ç.

```mermaid
stateDiagram
    [*] --> Closed
    Closed --> Open: –û—à–∏–±–æ–∫ —Å–ª–∏—à–∫–æ–º –º–Ω–æ–≥–æ
    Open --> HalfOpen: –í—Ä–µ–º—è –∏—Å—Ç–µ–∫–ª–æ
    HalfOpen --> Closed: –£–¥–∞–ª–æ—Å—å –≤—ã–ø–æ–ª–Ω–∏—Ç—å
    HalfOpen --> Open: –ù–µ —É–¥–∞–ª–æ—Å—å
```

### –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–∞ –ø—Ä–∞–∫—Ç–∏–∫–µ

–í —Ä–µ–∞–ª—å–Ω—ã—Ö —Å–∏—Å—Ç–µ–º–∞—Ö —ç—Ç–æ –Ω–µ ‚Äú–º–∞–≥–∏—á–µ—Å–∫–∏–π —Ñ–ª–∞–∂–æ–∫‚Äù, –∞ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–∞—è –ª–æ–≥–∏–∫–∞:

* –í **Closed** —Ä–µ–∂–∏–º–µ ‚Äî —à–ª—ë–º –∑–∞–ø—Ä–æ—Å—ã –∫–∞–∫ –æ–±—ã—á–Ω–æ, —Å—á–∏—Ç–∞–µ–º –æ—à–∏–±–∫–∏ (timeout, 5xx, –æ—Ç–∫–∞–∑ –≤ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–∏).
* –ü—Ä–∏ –ø—Ä–µ–≤—ã—à–µ–Ω–∏–∏ –ø–æ—Ä–æ–≥–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä, 5 –ø–æ–¥—Ä—è–¥ –æ—à–∏–±–æ–∫ –∏–ª–∏ 50% –∑–∞ –æ–∫–Ω–æ) ‚Äî **–ø–µ—Ä–µ–∫–ª—é—á–∞–µ–º—Å—è –≤ Open**, –∏ **–º–≥–Ω–æ–≤–µ–Ω–Ω–æ –æ—Ç–¥–∞—ë–º –æ—Ç–∫–∞–∑**, –Ω–µ –≤—ã–ø–æ–ª–Ω—è—è —Å–µ—Ç–µ–≤–æ–π –∑–∞–ø—Ä–æ—Å.
  –≠—Ç–æ –∑–∞—â–∏—â–∞–µ—Ç –≤–æ—Ä–∫–µ—Ä—ã, –±–∞–∑—É –∏ –æ—á–µ—Ä–µ–¥—å –æ—Ç –ª–∞–≤–∏–Ω—ã —Ö–≤–æ—Å—Ç–æ–≤.
* –ß–µ—Ä–µ–∑ `cooldown` (–Ω–∞–ø—Ä–∏–º–µ—Ä, 5 —Å–µ–∫—É–Ω–¥) breaker –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç –≤ **Half-Open** –∏ –¥–µ–ª–∞–µ—Ç **–æ–¥–∏–Ω –ø—Ä–æ–±–Ω—ã–π –∑–∞–ø—Ä–æ—Å**.
  –ï—Å–ª–∏ –æ–Ω —É—Å–ø–µ—à–µ–Ω ‚Äî –∑–∞–∫—Ä—ã–≤–∞–µ–º, –µ—Å–ª–∏ –Ω–µ—Ç ‚Äî —Å–Ω–æ–≤–∞ Open.

–¢–æ –µ—Å—Ç—å breaker –ø—Ä–µ–≤—Ä–∞—â–∞–µ—Ç –¥–ª–∏—Ç–µ–ª—å–Ω–æ–µ –∑–∞–≤–∏—Å–∞–Ω–∏–µ –≤ **–±—ã—Å—Ç—Ä—ã–π, –∫–æ–Ω—Ç—Ä–æ–ª–∏—Ä—É–µ–º—ã–π –æ—Ç–∫–∞–∑**, –∫–æ—Ç–æ—Ä—ã–π –Ω–µ —É–±–∏–≤–∞–µ—Ç –æ—Å—Ç–∞–ª—å–Ω—É—é —Å–∏—Å—Ç–µ–º—É.

---

### –ö–∞–∫ —ç—Ç–æ –≤—ã–≥–ª—è–¥–∏—Ç –≤ API

–¢–∏–ø–∏—á–Ω–æ –¥–µ–ª–∞—é—Ç middleware, –∫–æ—Ç–æ—Ä–æ–µ:

1. –ø—Ä–æ–≤–µ—Ä—è–µ—Ç —Å–æ—Å—Ç–æ—è–Ω–∏–µ breaker
2. –µ—Å–ª–∏ Open ‚Äî —Å—Ä–∞–∑—É –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –æ—à–∏–±–∫—É –∏–ª–∏ fallback
3. –µ—Å–ª–∏ Closed ‚Äî –¥–µ–ª–∞–µ—Ç –∑–∞–ø—Ä–æ—Å –∏ —Å—á–∏—Ç–∞–µ—Ç –æ—à–∏–±–∫–∏
4. –µ—Å–ª–∏ Half-Open ‚Äî –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –æ–¥–∏–Ω –ø—Ä–æ–±–Ω—ã–π –∑–∞–ø—Ä–æ—Å

–ü—Ä–∏–º–µ—Ä (–∏–¥–µ—è):

```php
if ($breaker->isOpen()) {
    throw new ServiceUnavailableException("Circuit open");
}

try {
    $response = $client->request(...);   // –≤–Ω–µ—à–Ω–∏–π —Å–µ—Ä–≤–∏—Å
    $breaker->markSuccess();
    return $response;
} catch (\Throwable $e) {
    $breaker->markFailure();
    throw $e;
}
```

---

### –ó–∞—á–µ–º –≤–æ–æ–±—â–µ –Ω—É–∂–µ–Ω?

–ü–æ—Ç–æ–º—É —á—Ç–æ –±–µ–∑ –Ω–µ–≥–æ:

* –≤—Å–µ –∑–∞–ø—Ä–æ—Å—ã –ø—Ä–æ–¥–æ–ª–∂–∞—é—Ç –≤–∏—Å–µ—Ç—å –Ω–∞ —Ç–∞–π–º–∞—É—Ç–∞—Ö
* —Ä–∞—Å—Ç—ë—Ç latency
* —Ä–∞—Å—Ç—É—Ç —Ä–µ—Ç—Ä–∞–∏
* —Ä–∞—Å—Ç—É—Ç –æ—á–µ—Ä–µ–¥–∏
* –±–∞–∑–∞ –ø–µ—Ä–µ–≥—Ä—É–∂–∞–µ—Ç—Å—è
* —Å–µ—Ä–≤–∏—Å —É–º–∏—Ä–∞–µ—Ç –ø–æ–ª–Ω–æ—Å—Ç—å—é

–° breaker‚Äô–æ–º:

* –æ—Å–Ω–æ–≤–Ω–æ–π –ø—É—Ç—å —Ä–∞–±–æ—Ç–∞–µ—Ç —Å—Ç–∞–±–∏–ª—å–Ω–æ
* low-priority –∏–ª–∏ –≤–Ω–µ—à–Ω–∏–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ ‚Äú–æ—Ç—Ä–µ–∑–∞—é—Ç—Å—è‚Äù, –ø–æ–∫–∞ –Ω–µ –æ–∂–∏–≤—É—Ç
* —Å–∏—Å—Ç–µ–º–∞ –Ω–µ –≤—Ö–æ–¥–∏—Ç –≤ retry-storm
* —É–º–µ–Ω—å—à–∞—é—Ç—Å—è —Ö–≤–æ—Å—Ç—ã –∏ queueing delays

---

### –ü–ª—é—Å—ã

* –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç –∫–∞—Å–∫–∞–¥–Ω—ã–µ –æ—Ç–∫–∞–∑—ã
* –∑–∞—â–∏—â–∞–µ—Ç –∫—Ä–∏—Ç–∏—á–Ω—ã–π –±–∏–∑–Ω–µ—Å-–ø—É—Ç—å
* –±—ã—Å—Ç—Ä–æ –æ–±–Ω–∞—Ä—É–∂–∏–≤–∞–µ—Ç –ø—Ä–æ–±–ª–µ–º—ã
* —É–º–µ–Ω—å—à–∞–µ—Ç –Ω–∞–≥—Ä—É–∑–∫—É –Ω–∞ –∑–∞–≤–∏—Å–∏–º—ã–µ —Å–µ—Ä–≤–∏—Å—ã

### –ú–∏–Ω—É—Å—ã

* –Ω—É–∂–Ω–∞ fallback-–ª–æ–≥–∏–∫–∞ (–∏–Ω–∞—á–µ —Ç–æ–ª–∫—É –º–∞–ª–æ)
* —Å–ª–æ–∂–Ω–æ –ø–æ–¥–æ–±—Ä–∞—Ç—å –ø–æ—Ä–æ–≥–∏ (–ø–æ–¥ —Å–ª–∏—à–∫–æ–º –Ω–∏–∑–∫–∏–º–∏ –æ–Ω ¬´—Ñ–ª–∞–ø–∞–µ—Ç¬ª, –ø–æ–¥ –≤—ã—Å–æ–∫–∏–º–∏ ‚Äî –≤–∫–ª—é—á–∞–µ—Ç—Å—è —Å–ª–∏—à–∫–æ–º –ø–æ–∑–¥–Ω–æ)

---

# üîπ 2.3 –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ —Ä–µ—à–µ–Ω–∏—è

---

# ‚úî Local Caching (L1)

–≠—Ç–æ super-fast –∫—ç—à –ø—Ä—è–º–æ –≤ –ø–∞–º—è—Ç–∏ PHP: APCu, shared-memory, preloaded config –∏ —Ç. –¥.

–ü–ª—é—Å—ã: —Å–∫–æ—Ä–æ—Å—Ç—å ‚Üí <1ms
–ú–∏–Ω—É—Å—ã: **invalidation –±–æ–ª—å–Ω–∞—è**, coherence –ª–æ–º–∞–µ—Ç—Å—è.

---

# ‚úî Micro-sharding

–ï—Å–ª–∏ –æ–¥–∏–Ω shard —Ç–æ—Ä–º–æ–∑–∏—Ç ‚Äî –≤—Å—è —Å–∏—Å—Ç–µ–º–∞ —Ç–µ—Ä—è–µ—Ç p99.

Micro-sharding –¥–∞—ë—Ç:

* –∫–æ–º–ø–∞–∫—Ç–Ω—ã–µ –º–∞–ª–µ–Ω—å–∫–∏–µ shard'—ã
* –º–∏–≥—Ä–∞—Ü–∏—é –±–µ–∑ –±–æ–ª–∏
* –∏–∑–æ–ª—è—Ü–∏—é hot spots

---

# ‚úî Queue-Based Load Leveling (–∫–æ—Ä–æ—Ç–∫–æ, –Ω–æ –ø–æ–Ω—è—Ç–Ω–æ)

–ö–æ–≥–¥–∞ —Ç—Ä–∞—Ñ–∏–∫ –∏–¥—ë—Ç –Ω–µ—Ä–∞–≤–Ω–æ–º–µ—Ä–Ω–æ, —Å–∏—Å—Ç–µ–º–∞ –ø–æ–ª—É—á–∞–µ—Ç **–ø–∏–∫–∏**, –∏–∑-–∑–∞ –∫–æ—Ç–æ—Ä—ã—Ö:

* —Ä–∞—Å—Ç—ë—Ç latency
* –∑–∞–±–∏–≤–∞—é—Ç—Å—è –æ—á–µ—Ä–µ–¥–∏ –≤–æ—Ä–∫–µ—Ä–æ–≤
* –±–∞–∑–∞ —É–º–∏—Ä–∞–µ—Ç
* p99 —Ä–∞–∑–ª–µ—Ç–∞–µ—Ç—Å—è

–û—á–µ—Ä–µ–¥—å (MQ) –≤—Å—Ç–∞–≤–ª—è–µ—Ç—Å—è **–º–µ–∂–¥—É API –∏ —Ç—è–∂—ë–ª–æ–π –ª–æ–≥–∏–∫–æ–π**, —á—Ç–æ–±—ã –ø—Ä–µ–≤—Ä–∞—Ç–∏—Ç—å —Ö–∞–æ—Ç–∏—á–Ω—ã–µ –≤—Å–ø–ª–µ—Å–∫–∏ –≤ **—Ä–æ–≤–Ω—ã–π –ø–æ—Ç–æ–∫**.

---

## üéØ –ú–µ–Ω—Ç–∞–ª—å–Ω–∞—è –º–æ–¥–µ–ª—å

**–ë–µ–∑ –æ—á–µ—Ä–µ–¥–∏:**

–ü–∏–∫ —Ç—Ä–∞—Ñ–∏–∫–∞ = –ø–∏–∫ –Ω–∞–≥—Ä—É–∑–∫–∏ = —Å–º–µ—Ä—Ç—å –±—ç–∫–µ–Ω–¥–∞.

**–° –æ—á–µ—Ä–µ–¥—å—é:**

–ü–∏–∫ —Ç—Ä–∞—Ñ–∏–∫–∞ ‚Üí ‚Äú–≥–∞—Å–∏—Ç—Å—è‚Äù –≤ –æ—á–µ—Ä–µ–¥–∏ ‚Üí –≤–æ—Ä–∫–µ—Ä—ã –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç **—Ä–æ–≤–Ω—ã–º –∫–æ–Ω—Ç—Ä–æ–ª–∏—Ä—É–µ–º—ã–º —Ç–µ–º–ø–æ–º**.

---

## üß¨ –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

```mermaid
flowchart LR
    A[API / Gateway] -->|–±—ã—Å—Ç—Ä—ã–π enqueue| B[Message Queue]
    B -->|—Ä–æ–≤–Ω—ã–π –ø–æ—Ç–æ–∫| C[Workers]
    C -->|batch / rate control| D[(DB)]
```

API –±–æ–ª—å—à–µ –Ω–µ –¥–µ–ª–∞–µ—Ç —Ç—è–∂—ë–ª—É—é —Ä–∞–±–æ—Ç—É.
–û–Ω –ø—Ä–æ—Å—Ç–æ –∫–ª–∞–¥—ë—Ç –∑–∞–¥–∞—á—É –≤ –æ—á–µ—Ä–µ–¥—å –∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –æ—Ç–≤–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é –∑–∞ 20‚Äì50ms.

---

## üî• –ß—Ç–æ –¥–∞—ë—Ç load leveling

### ‚úî 1. –°—Ç–∞–±–∏–ª—å–Ω—ã–π throughput

Workers —Ä–∞–±–æ—Ç–∞—é—Ç —Å —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–æ–π —Å–∫–æ—Ä–æ—Å—Ç—å—é ‚Üí –±–∞–∑–∞ –Ω–µ –ø–µ—Ä–µ–≥—Ä—É–∂–∞–µ—Ç—Å—è.

### ‚úî 2. –ë—ã—Å—Ç—Ä—ã–π API

–ó–∞–ø—Ä–æ—Å—ã –Ω–µ –∂–¥—É—Ç –≤–Ω–µ—à–Ω–∏—Ö —Å–∏—Å—Ç–µ–º.
‚Äú–õ—ë–≥–∫–∏–π‚Äù –ø—É—Ç—å –æ—Å—Ç–∞—ë—Ç—Å—è –ª—ë–≥–∫–∏–º.

### ‚úî 3. –ü–∏–∫–∏ —Å–≥–ª–∞–∂–∏–≤–∞—é—Ç—Å—è

100k –∑–∞–ø—Ä–æ—Å–æ–≤ –∑–∞ —Å–µ–∫—É–Ω–¥—É –ø—Ä–µ–≤—Ä–∞—â–∞—é—Ç—Å—è –≤:

* 100k —Å–æ–æ–±—â–µ–Ω–∏–π –≤ –æ—á–µ—Ä–µ–¥–∏
* * –ø–ª–∞–≤–Ω—É—é –æ–±—Ä–∞–±–æ—Ç–∫—É –≤ —Ç–µ—á–µ–Ω–∏–µ –º–∏–Ω—É—Ç

### ‚úî 4. –£–ø—Ä–∞–≤–ª—è–µ–º–∞—è –¥–µ–≥—Ä–∞–¥–∞—Ü–∏—è

–ï—Å–ª–∏ –æ—á–µ—Ä–µ–¥—å —Ä–∞—Å—Ç—ë—Ç ‚Üí –º–æ–∂–Ω–æ —Å–Ω–∏–∂–∞—Ç—å –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç—ã, –∑–∞–º–µ–¥–ª—è—Ç—å ingestion, –æ—Ç–¥–∞–≤–∞—Ç—å 429.

---

## üéì –ì–¥–µ –ø—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è

**–ò–¥–µ–∞–ª—å–Ω–æ:**

* –æ—Ç–ø—Ä–∞–≤–∫–∞ email/SMS
* –ø–ª–∞—Ç–µ–∂–∏ (–∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞)
* —Ç—è–∂—ë–ª—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ (–∏–Ω–¥–µ–∫—Å–∞—Ü–∏–∏, –ø–µ—Ä–µ—Å—á—ë—Ç—ã)
* –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –æ—Ç—á—ë—Ç–æ–≤
* –≤—Å–µ, –≥–¥–µ –≤–∞–∂–µ–Ω SLA API, –Ω–æ –Ω–µ –º–≥–Ω–æ–≤–µ–Ω–Ω—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç

**–ù–µ –ø–æ–¥—Ö–æ–¥–∏—Ç:**

* login
* –ø–æ–ª—É—á–µ–Ω–∏–µ –ø—Ä–æ—Ñ–∏–ª—è
* –æ–ø–µ—Ä–∞—Ü–∏–∏, –≥–¥–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é –Ω—É–∂–µ–Ω –ø—Ä—è–º–æ–π –æ—Ç–≤–µ—Ç

---

# ‚úî Background jittering

–ï—Å–ª–∏ —É —Ç–µ–±—è 100 pod'–æ–≤ –∏ cron –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –≤ 00:00:00 —É –≤—Å–µ—Ö ‚Äî
—Ç—ã —Å–∞–º —Å–µ–±–µ —Å–æ–∑–¥–∞—ë—à—å thundering herd.

–†–µ—à–µ–Ω–∏–µ:

* —Ä–∞–∑–Ω–æ—Å–∏—Ç—å –∑–∞–¥–∞—á–∏ –≤–æ –≤—Ä–µ–º–µ–Ω–∏
* –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å jitter
* –¥–µ–ª–∞—Ç—å random delay ¬± 20%

---

# üéØ –ë–õ–û–ö 3: –ü–†–ê–ö–¢–ò–ß–ï–°–ö–ò–ï –°–û–í–ï–¢–´ (5‚Äì7 –º–∏–Ω)

–í —ç—Ç–æ–º –±–ª–æ–∫–µ –Ω–∞–¥–æ –≤–µ—Ä–Ω—É—Ç—å –∑—Ä–∏—Ç–µ–ª—è –∏–∑ ¬´–±–æ–ª—å—à–æ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã¬ª –∫ –ø–æ–Ω—è—Ç–Ω—ã–º –¥–µ–π—Å—Ç–≤–∏—è–º, –∫–æ—Ç–æ—Ä—ã–µ –æ–Ω –º–æ–∂–µ—Ç –≤–Ω–µ–¥—Ä–∏—Ç—å —É —Å–µ–±—è –ø—Ä—è–º–æ –∑–∞–≤—Ç—Ä–∞.

–ì–ª–∞–≤–Ω—ã–π –ø–æ—Å—ã–ª:

> Tail latency ‚Äî —ç—Ç–æ –Ω–µ –∞–±—Å—Ç—Ä–∞–∫—Ç–Ω–∞—è –ø—Ä–æ–±–ª–µ–º–∞. –≠—Ç–æ –ø—Ä–æ—Å—Ç–æ –ø–ª–æ—Ö–∏–µ –º–µ—Ç—Ä–∏–∫–∏.
> –ï—Å–ª–∏ —Ç—ã –∏—Ö —Ö–æ—Ä–æ—à–æ –º–µ—Ä—è–µ—à—å, —Ç—ã —É–∂–µ –≤ —Ç–æ–ø-10% –∏–Ω–∂–µ–Ω–µ—Ä–æ–≤.

---

# 3.1 –ß—Ç–æ –º–µ—Ä–∏—Ç—å –≤ —Ä–µ–∞–ª—å–Ω–æ–º –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ

–ë–æ–ª—å—à–∏–Ω—Å—Ç–≤–æ –∫–æ–º–∞–Ω–¥ –º–æ–Ω–∏—Ç–æ—Ä–∏—Ç **—Å—Ä–µ–¥–Ω–µ–µ**.
–≠—Ç–æ –±–µ—Å–ø–æ–ª–µ–∑–Ω–æ.

–ú–æ–Ω–∏—Ç–æ—Ä–∏—Ç—å –Ω–∞–¥–æ **—Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ** –∑–∞–¥–µ—Ä–∂–µ–∫. –í–æ—Ç –≥–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –Ω–∞–±–æ—Ä:

### ‚úî p50 ‚Äî –∑–¥–æ—Ä–æ–≤—å–µ –æ–±—ã—á–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤

–ï—Å–ª–∏ p50 –ø—Ä—ã–≥–Ω—É–ª ‚Äî —ç—Ç–æ –∑–Ω–∞—á–∏—Ç –ø—Ä–æ–±–ª–µ–º–∞ –∏–ª–∏ –≤ –∫–æ–¥–µ, –∏–ª–∏ –≤ –ë–î.

### ‚úî p95 ‚Äî –ø–µ—Ä–≤—ã–µ —Å–∏–º–ø—Ç–æ–º—ã –±–æ–ª–∏

–ï—Å–ª–∏ —Ä–∞—Å—Ç—ë—Ç p95 ‚Üí —Å–∫–æ—Ä–æ –±—É–¥–µ—Ç –±–µ–¥–∞.

### ‚úî p99 ‚Äî —Ä–µ–∞–ª—å–Ω–æ—Å—Ç—å –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞

–≠—Ç–æ –∫–ª—é—á–µ–≤–∞—è –º–µ—Ç—Ä–∏–∫–∞ –¥–ª—è –≤—Å–µ–≥–æ –≤–∏–¥–µ–æ.

### ‚úî p999 ‚Äî –∑–æ–Ω–∞ ‚Äú–≥—Ä–æ–±–∏—Ç –ø—Ä–æ–¥‚Äù

–¢—É—Ç –∂–∏–≤—É—Ç GC-–ø–∞—É–∑–∫–∏, —Ç–æ—Ä–º–æ–∑–Ω—ã–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã, NUMA, —Ä–µ—Ç—Ä–∞–∏, –∏ –≤—Å—è–∫–∞—è –Ω–µ—á–∏—Å—Ç—å.

### ‚úî Rate of retries

–ï—Å–ª–∏ —Ä–∞—Å—Ç—ë—Ç ‚Äî –ø—Ä–æ–±–ª–µ–º–∞ —É–∂–µ –∏–¥—ë—Ç –ø–æ —Ü–µ–ø–æ—á–∫–µ.

### ‚úî Queue length (–Ω–∞ API/Gateway/DB/Redis/kafka)

–û—á–µ—Ä–µ–¥—å —Ä–∞—Å—Ç—ë—Ç ‚Üí –∑–∞–¥–µ—Ä–∂–∫–∞ –Ω–µ–∏–∑–±–µ–∂–Ω–∞.
–≠—Ç–æ —Ç–æ—Ç —Å–∞–º—ã–π Little's Law, —Ç–µ–ø–µ—Ä—å –Ω–µ –∫–∞–∫ –∞–∫–∞–¥–µ–º–∏—á–µ—Å–∫–∞—è —Ñ–∏–≥–Ω—è, –∞ –∫–∞–∫ —Ä–µ–∞–ª—å–Ω–∞—è –±–æ–ª—å.

---

# 3.2 Histogram vs Summary

–ï—Å–ª–∏ —Ç—ã –∏—Å–ø–æ–ª—å–∑—É–µ—à—å Prometheus:

* **summary** –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç p95/p99, –Ω–æ —Ç–æ–ª—å–∫–æ –Ω–∞ –æ–¥–Ω–æ–π –Ω–æ–¥–µ
* **histogram** –ø–æ–∑–≤–æ–ª—è–µ—Ç –∞–≥—Ä–µ–≥–∏—Ä–æ–≤–∞—Ç—å –ø–æ –≤—Å–µ–º –Ω–æ–¥–∞–º

–í –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–æ–≤ ‚Äî —Ç–æ–ª—å–∫–æ histograms.
Summary –ª–æ–º–∞–µ—Ç –∫–∞—Ä—Ç–∏–Ω—É –∏ —Å–∫—Ä—ã–≤–∞–µ—Ç —Ö–≤–æ—Å—Ç—ã.

---

# 3.3 Distributed tracing –∫–∞–∫ —Ä–µ–Ω—Ç–≥–µ–Ω tail latency

–ó–¥–µ—Å—å –º–æ–∂–Ω–æ –ø–æ–∫–∞–∑–∞—Ç—å Jaeger/Tempo/Zipkin.

–ß—Ç–æ –¥–∞—ë—Ç —Ç—Ä–∞—Å—Å–∏—Ä–æ–≤–∫–∞:

* –≤–∏–¥–∏—à—å, –∫–∞–∫–æ–π —Å–µ—Ä–≤–∏—Å –¥–∞–ª —Ö–≤–æ—Å—Ç
* –≤–∏–¥–∏—à—å, –Ω–∞ –∫–∞–∫–æ–º —à–∞–≥–µ –∑–∞–ø—Ä–æ—Å –ø–æ–≤–∏—Å
* –ª–µ–≥–∫–æ –Ω–∞—Ö–æ–¥–∏—à—å –ª–æ–∫–∏
* –≤–∏–¥–∏—à—å –≥–¥–µ –≤–æ–∑–Ω–∏–∫ retried storm
* –≤–∏–¥–∏—à—å cross-shard –æ–ø–µ—Ä–∞—Ü–∏–∏

–î–æ–±–∞–≤—å —Ç–∞–∫—É—é –¥–∏–∞–≥—Ä–∞–º–º—É:

```mermaid
graph TD
A[Request start]
A --> B[API Gateway<br/>10ms]
B --> C[Service A<br/>30ms]
C --> D[Service B<br/>250ms p99]
D --> E[Database<br/>12ms]
E --> F[–û—Ç–≤–µ—Ç –∫–ª–∏–µ–Ω—Ç—É]
```

–°—Ä–∞–∑—É –≤–∏–¥–Ω–æ, –≥–¥–µ –ª–µ–∂–∏—Ç p99.

---

# 3.4 Alerting: –Ω–∞ —á—Ç–æ —Ä–µ–∞–ª—å–Ω–æ —Å—Ç–∞–≤–∏—Ç—å –∞–ª–µ—Ä—Ç—ã

–ù–µ –Ω–∞–¥–æ –±—É–¥–∏—Ç—å –∏–Ω–∂–µ–Ω–µ—Ä–æ–≤ –ø—Ä–∏ `average latency > 50ms`.

–ù–∞–¥–æ:

### ‚úî p99 > 10 √ó p50

–°–∏–ª—å–Ω—ã–π —Å–∏–≥–Ω–∞–ª, —á—Ç–æ —Ö–≤–æ—Å—Ç –ø–æ–ø–æ–ª–∑.

### ‚úî —Ä–æ—Å—Ç –æ—á–µ—Ä–µ–¥–µ–π

–û—Å–æ–±–µ–Ω–Ω–æ –Ω–∞ LB –∏ –ë–î.

### ‚úî —Ä–æ—Å—Ç –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ —Ä–µ—Ç—Ä–∞–µ–≤

–û–±—ã—á–Ω–æ —ç—Ç–æ —Ä–∞–Ω–Ω–∏–π —Å–∏–≥–Ω–∞–ª cascade failure.

### ‚úî —Ä–æ—Å—Ç –¥–æ–ª–∏ `5xx` –æ—Ç downstream —Å–µ—Ä–≤–∏—Å–æ–≤

–ï—Å–ª–∏ p99 –≤—ã—Ä–æ—Å ‚Üí –æ—à–∏–±–∫–∏ –Ω–µ–∏–∑–±–µ–∂–Ω—ã.

---

# 3.5 –ö—Ä–∞—Å–Ω—ã–µ —Ñ–ª–∞–≥–∏ (–∫–æ—Ç–æ—Ä—ã–µ –¥–æ–ª–∂–µ–Ω –±–æ—è—Ç—å—Å—è –∫–∞–∂–¥—ã–π)

* p99 –≥—É–ª—è–µ—Ç –∫–∞–∫ —Ö–æ—á–µ—Ç
* —Ä–∞–∑–Ω–∏—Ü–∞ –º–µ–∂–¥—É p99 –∏ p50 > 20‚Äì30√ó
* –≤–æ—Ä–∫–µ—Ä—ã –∏–Ω–æ–≥–¥–∞ –ø–æ–¥–≤–∏—Å–∞—é—Ç –Ω–∞ 1‚Äì2 —Å–µ–∫—É–Ω–¥—ã
* Redis –≤–Ω–µ–∑–∞–ø–Ω–æ –¥–µ–ª–∞–µ—Ç EVICT
* Kafka lag –Ω–µ—Å—Ç–∞–±–∏–ª–µ–Ω
* ‚Äú–∏–Ω–æ–≥–¥–∞ checkout 2 —Å–µ–∫—É–Ω–¥—ã‚Äù ‚Äî –Ω–∏–∫—Ç–æ –Ω–µ —Ä–∞–∑–±–∏—Ä–∞–ª—Å—è

–≠—Ç–æ –≤—Å—ë —Å–∏–º–ø—Ç–æ–º—ã tail latency, –ø—Ä–æ—Å—Ç–æ –Ω–µ –≤—Å–µ–≥–¥–∞ —ç—Ç–æ —Ç–∞–∫ –Ω–∞–∑—ã–≤–∞—é—Ç.

---

# üèÅ –ó–ê–ö–õ–Æ–ß–ï–ù–ò–ï (2‚Äì3 –º–∏–Ω)

–≠—Ç–æ –º–µ—Å—Ç–æ, –≥–¥–µ –Ω–∞–¥–æ —Å–æ–±—Ä–∞—Ç—å –≤—Å—ë –≤ –æ–¥–∏–Ω –ø—Ä–æ—Å—Ç–æ–π –ø–æ—Å—ã–ª, —á—Ç–æ–±—ã –∑—Ä–∏—Ç–µ–ª—å —É—à—ë–ª —Å —á—ë—Ç–∫–∏–º –≤—ã–≤–æ–¥–æ–º.

---

# ‚úî –û—Å–Ω–æ–≤–Ω—ã–µ –∏—Å—Ç–∏–Ω—ã –æ Tail Latency

### 1) Tail latency ‚Äî —ç—Ç–æ –Ω–µ –±–∞–≥. –≠—Ç–æ —Ñ–∏–∑–∏–∫–∞ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω—ã—Ö —Å–∏—Å—Ç–µ–º.

–õ—é–±–æ–π —Å–µ—Ä–≤–∏—Å –ø–æ–¥ –Ω–∞–≥—Ä—É–∑–∫–æ–π –Ω–∞—á–∏–Ω–∞–µ—Ç ¬´—Ç—è–Ω—É—Ç—å —Ö–≤–æ—Å—Ç¬ª.

### 2) –•–≤–æ—Å—Ç—ã –Ω–µ–ª—å–∑—è –ø–æ–ª–Ω–æ—Å—Ç—å—é —É–±—Ä–∞—Ç—å.

–ú–æ–∂–Ω–æ —Ç–æ–ª—å–∫–æ:

* —É–º–µ–Ω—å—à–∏—Ç—å,
* –∑–∞–º–∞—Å–∫–∏—Ä–æ–≤–∞—Ç—å,
* –∏–∑–æ–ª–∏—Ä–æ–≤–∞—Ç—å,
* —Å–≥–ª–∞–¥–∏—Ç—å.

### 3) –£–≤–µ–ª–∏—á–µ–Ω–∏–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ —Å–µ—Ä–≤–∏—Å–æ–≤ ‚Üí —Ö–≤–æ—Å—Ç —Ä–∞—Å—Ç—ë—Ç –Ω–µ–ª–∏–Ω–µ–π–Ω–æ

p99 –æ–¥–Ω–æ–≥–æ —Å–µ—Ä–≤–∏—Å–∞ ‚Üí –ø—Ä–µ–≤—Ä–∞—â–∞–µ—Ç—Å—è –≤ —Å–µ–∫—É–Ω–¥—ã –Ω–∞ —Ü–µ–ø–æ—á–∫–µ.

### 4) –†–µ—à–µ–Ω–∏—è –ª–µ–∂–∞—Ç –Ω–∞ —Ç—Ä—ë—Ö —É—Ä–æ–≤–Ω—è—Ö:

* –∫–æ—Ä–æ—Ç–∫–æ—Å—Ä–æ—á–Ω—ã–µ ‚Äî hedging, tied, coalescing
* –¥–æ–ª–≥–æ—Å—Ä–æ—á–Ω—ã–µ ‚Äî latency-aware LB, deadline propagation, circuit breakers
* –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ ‚Äî L1/L2 caching, microsharding, async queues, background jitter

### 5) –•–æ—Ä–æ—à–∏–µ –º–µ—Ç—Ä–∏–∫–∏ ‚Äî –ø–æ–ª–æ–≤–∏–Ω–∞ –ø–æ–±–µ–¥—ã

–ï—Å–ª–∏ –∫–æ–º–∞–Ω–¥–∞ —à–ª—ë—Ç –∞–ª–µ—Ä—Ç—ã –ø–æ —Å—Ä–µ–¥–Ω–µ–º—É ‚Äî –æ–Ω–∞ –Ω–∏–∫–æ–≥–¥–∞ –Ω–µ –ø–æ–±–µ–¥–∏—Ç tail latency.

---

# ‚úî –ó–∞–≤–µ—Ä—à–∞—é—â–∏–π –º–µ—Å—Å–µ–¥–∂

> –í –º–∏—Ä–µ –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–æ–≤ –≤–∞—à–∞ —Å–∏—Å—Ç–µ–º–∞ –Ω–∏–∫–æ–≥–¥–∞ –Ω–µ –±—É–¥–µ—Ç –±—ã—Å—Ç—Ä–µ–µ —Å–≤–æ–µ–≥–æ —Ö–≤–æ—Å—Ç–∞.
> –ò–Ω–∂–µ–Ω–µ—Ä—ã, –∫–æ—Ç–æ—Ä—ã–µ —É–º–µ—é—Ç —Ä–∞–±–æ—Ç–∞—Ç—å —Å p99, –∂–∏–≤—É—Ç –≤ –¥—Ä—É–≥–æ–º –º–∏—Ä–µ, –≥–¥–µ –ø—Ä–æ–¥–∞–∫—à–µ–Ω –Ω–µ –≤–∞–ª–∏—Ç—Å—è –ø–æ –≤–æ—Å–∫—Ä–µ—Å–µ–Ω—å—è–º –≤ 4 —É—Ç—Ä–∞.

–û—Å—Ç–∞–≤–ª—è–π —Å—Å—ã–ª–∫—É –Ω–∞ —Ä–µ—Å—É—Ä—Å—ã:

* Google: *The Tail at Scale*
* AWS Builder‚Äôs Library: *Timeouts, Retries, and Backoff*
* HighScalability articles about queuing
* Martin Kleppmann: *Designing Data-Intensive Applications*
