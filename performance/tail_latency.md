–ù—É –¥–∞–≤–∞–π, –¥–µ—Ä–∂–∏—Å—å. Tail latency ‚Äî —ç—Ç–æ —Ç–∞ —Å–∞–º–∞—è –≥–∞–¥–æ—Å—Ç—å, –∫–æ—Ç–æ—Ä–∞—è –¥–µ–ª–∞–µ—Ç –≤–∏–¥, —á—Ç–æ —É —Ç–µ–±—è ‚Äú–≤—Å—ë –±—ã—Å—Ç—Ä–æ‚Äù, –∞ –ø–æ—Ç–æ–º –≤ —Ä–∞–Ω–¥–æ–º–Ω—ã–π –º–æ–º–µ–Ω—Ç —É—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç —Ç–µ–±–µ –º–∞–ª–µ–Ω—å–∫–∏–π –∞–ø–æ–∫–∞–ª–∏–ø—Å–∏—Å.

–Ø —Ä–∞—Å—Å–∫–∞–∂—É —Ç–µ–±–µ –∫–∞–∫ —á–µ–ª–æ–≤–µ–∫—É, –∫–æ—Ç–æ—Ä—ã–π –≤ –ø—Ä–æ–¥–∞—Ö –∂–∏–≤—ë—Ç, –∞ –Ω–µ —É—á–µ–±–Ω–∏–∫–∏ –ª–∏—Å—Ç–∞–µ—Ç.

---

# üß® –ß—Ç–æ —Ç–∞–∫–æ–µ Tail Latency (–∏ –ø–æ—á–µ–º—É —ç—Ç–æ —Ç–µ–±—è –¥–æ–ª–∂–Ω–æ –≤–æ–ª–Ω–æ–≤–∞—Ç—å)


`Latency` ‚Äî –≤—Ä–µ–º—è –æ—Ç–≤–µ—Ç–∞

–°—Ä–µ–¥–Ω—è—è Latency ‚Äî —ç—Ç–æ –¥–µ–∫–æ—Ä–∞—Ç–∏–≤–Ω—ã–π –ø–æ–∫–∞–∑–∞—Ç–µ–ª—å –¥–ª—è –ø—Ä–µ–∑–µ–Ω—Ç–∞—Ü–∏–π CTO.
–ù–∞—Å—Ç–æ—è—â–∞—è –±–æ–ª—å –ª–µ–∂–∏—Ç –≤ —Ö–≤–æ—Å—Ç–∞—Ö: **p95 / p99 / p999**.

–≠—Ç–æ —Ç–µ *—Ä–µ–¥–∫–∏–µ* –∑–∞–ø—Ä–æ—Å—ã, –∫–æ—Ç–æ—Ä—ã–µ:

* –≤–Ω–µ–∑–∞–ø–Ω–æ –µ–¥—É—Ç –≤–º–µ—Å—Ç–æ 20ms ‚Üí 400ms
* –∏–ª–∏ 2 —Å–µ–∫—É–Ω–¥—ã
* –∏–ª–∏ 10 —Å–µ–∫—É–Ω–¥ (–ø—Ä–∏–≤–µ—Ç, GC, —Å–µ—Ç—å, –¥–∏—Å–∫)
* –∏–ª–∏ –≤–æ–æ–±—â–µ —Ç–∞–π–º–∞—É—Ç—è—Ç

–ò —ç—Ç–∏ —Ä–µ–¥–∫–∏–µ –∑–∞–ø—Ä–æ—Å—ã **–ª–æ–º–∞—é—Ç UX, –æ—á–µ—Ä–µ–¥–∏, —Ç–∞–π–º–∞—É—Ç—ã, —Ä–µ—Ç—Ä–∞–∏, –±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫—É**, –∏ –∑–∞–æ–¥–Ω–æ —Ç–≤–æ—ë –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ.

---

# üìà –ú–∏–Ω–∏-–≥—Ä–∞—Ñ–∏–∫ –¥–ª—è –≤–∏–∑—É–∞–ª–∞ (mermaid)
![img.png](img.png)

–í–æ—Ç –ø—Ä–∏–º–µ—Ä–Ω–æ —Ç–∞–∫ –≤—ã–≥–ª—è–¥–∏—Ç —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ª–∞—Ç–µ–Ω—Ç–Ω–æ—Å—Ç–∏:

* 90% –∑–∞–ø—Ä–æ—Å–æ–≤ –±—ã—Å—Ç—Ä—ã–µ
* –Ω–æ —Ö–≤–æ—Å—Ç (p99, p999) –∂–∏–≤—ë—Ç —Å–≤–æ–µ–π –∂–∏–∑–Ω—å—é
* –∏ –∏–º–µ–Ω–Ω–æ –æ–Ω –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å —Å–∏—Å—Ç–µ–º—ã

---

# ü•© –ß—Ç–æ –∏–º–µ–Ω–Ω–æ –Ω–∞–¥–æ –ø–æ–Ω–∏–º–∞—Ç—å

## 1. –°—Ä–µ–¥–Ω–µ–µ –∑–Ω–∞—á–µ–Ω–∏–µ **–±–µ—Å—Å–º—ã—Å–ª–µ–Ω–Ω–æ**

–ï—Å–ª–∏ –º–µ–¥–∏–∞–Ω–∞ (p50) = 20ms, –Ω–æ p99 = 1 —Å–µ–∫—É–Ω–¥–∞ ‚Äî
–∑–Ω–∞—á–∏—Ç 1% –∑–∞–ø—Ä–æ—Å–æ–≤ –º–µ–¥–ª–µ–Ω–Ω–µ–µ –≤ 50 —Ä–∞–∑.

–ò —ç—Ç–∏ 1%:

* –ª–æ–º–∞—é—Ç checkout
* —Ä–≤—É—Ç —Ü–µ–ø–æ—á–∫–∏ –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–æ–≤
* –≤—ã–∑—ã–≤–∞—é—Ç retry storm
* —Å–æ–∑–¥–∞—é—Ç –æ—á–µ—Ä–µ–¥–∏, –∫–æ—Ç–æ—Ä—ã–µ —Ç—è–Ω—É—Ç –≤—Å—ë –≤–Ω–∏–∑
* –ø—Ä–µ–≤—Ä–∞—â–∞—é—Ç –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ —Å–Ω–µ–∂–Ω—ã–π –∫–æ–º

---

## 2. Tail latency —Ä–∞—Å—Ç—ë—Ç –ø—Ä–∏ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–∏

Google –≤ —Å—Ç–∞—Ç—å–µ **"The Tail at Scale"** (—á–∏—Ç–∞–π –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ, –æ–Ω–æ –∫—É–ª—å—Ç–æ–≤–æ–µ) –ø–æ–∫–∞–∑–∞–ª:

> –ï—Å–ª–∏ —Ç–≤–æ–π –∑–∞–ø—Ä–æ—Å –∑–∞–≤–∏—Å–∏—Ç –æ—Ç 100 –±—ç–∫–µ–Ω–¥-–∑–∞–ø—Ä–æ—Å–æ–≤,
> —Ç–æ –≤–º–µ—Å—Ç–æ —Ç–≤–æ–µ–≥–æ p99 —Ç—ã –≤–∏–¥–∏—à—å p99^100.

–¢–æ –µ—Å—Ç—å –º–∞–ª–µ–Ω—å–∫–∏–π —Ö–≤–æ—Å—Ç ‚Üí –≤ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω–æ–π —Å–∏—Å—Ç–µ–º–µ ‚Üí –ø—Ä–µ–≤—Ä–∞—â–∞–µ—Ç—Å—è –≤ —á—É–¥–æ–≤–∏—â–µ.

üîó Google‚Äôs The Tail at Scale:
[https://research.google/pubs/the-tail-at-scale/](https://research.google/pubs/the-tail-at-scale/)

---

## 3. Tail latency —á–∞—Å—Ç–æ ‚Äú—Å–ª—É—á–∞–π–Ω–∞—è‚Äù, –Ω–æ –ø—Ä–∏—á–∏–Ω—ã –±–∞–Ω–∞–ª—å–Ω–æ –∑–µ–º–Ω—ã–µ

### –ê–ø–ø–∞—Ä–∞—Ç–Ω—ã–µ:

* GC –ø–∞—É–∑–∞
* CPU –Ω–µ–Ω–∞–¥–æ–ª–≥–æ –≤—ã–ª–µ—Ç–µ–ª –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å —á—É–∂–æ–π –ø—Ä–æ—Ü–µ—Å—Å
* –¥–∏—Å–∫ –¥–µ—Ä–Ω—É–ª—Å—è
* —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –ø–∞–º—è—Ç–∏ –≤—ã–≥—Ä—É–∂–µ–Ω–∞
* NUMA –ø–µ—Ä–µ—Å–∫–æ—á–∏–ª–æ

### –°–µ—Ç–µ–≤—ã–µ:

* –æ–¥–∏–Ω –ø–ª–æ—Ö–æ–π hop
* –ø–∏–Ω–≥ –≤—Å–ø–ª–µ—Å–Ω—É–ª
* –ø–µ—Ä–µ–≥—Ä—É–∂–µ–Ω–Ω—ã–π —Ä–æ—É—Ç–µ—Ä
* —Ç—Ä–∞—Ñ–∏–∫ –Ω–∞ –∫–∞–Ω–∞–ª–µ

### –ù–∞ —É—Ä–æ–≤–Ω–µ —Å–µ—Ä–≤–∏—Å–æ–≤:

* –æ–¥–∏–Ω –∏–Ω—Å—Ç–∞–Ω—Å ‚Äú–∑–∞–≤–∏—Å‚Äù
* hot key –±–ª–æ–∫–∏—Ä—É–µ—Ç —á—Ç–æ-—Ç–æ
* –ª–æ–∫ –≤–∏—Å–∏—Ç –¥–æ–ª—å—à–µ
* —Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏—è/–¥–µ—Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏—è 5MB JSON
* –æ–¥–∏–Ω shard –≤ –∫–ª–∞—Å—Ç–µ—Ä–Ω–æ–π –ë–î —Ç–æ—Ä–º–æ–∑–∏—Ç

---

## 4. Tail latency —Ä–∞–∑—Ä—É—à–∞–µ—Ç –≤—Å—ë —Ü–µ–ø–æ—á–∫–∏ –≤—ã–∑–æ–≤–æ–≤

–ö–ª–∞—Å—Å–∏–∫–∞:

1. –ú–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å –ê –≤—ã–∑—ã–≤–∞–µ—Ç B
2. B –≤—ã–∑—ã–≤–∞–µ—Ç C
3. C –≤—ã–∑—ã–≤–∞–µ—Ç D

–ï—Å–ª–∏ —É D –ø99 = 500ms ‚Üí —É –≤—Å–µ–π —Ü–µ–ø–æ—á–∫–∏ ‚Äú–ø—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∞—è –ª–∞—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å‚Äù —É–ª–µ—Ç–∞–µ—Ç.

–ê –ø–æ—Ç–æ–º:

* –≤–µ–∑–¥–µ –ø—Ä–æ–∏—Å—Ö–æ–¥—è—Ç —Ç–∞–π–º–∞—É—Ç—ã
* –∏–¥—É—Ç —Ä–µ—Ç—Ä–∞–∏
* –Ω–∞–≥—Ä—É–∑–∫–∞ –≤–∑–ª–µ—Ç–∞–µ—Ç
* –Ω–∞—á–∏–Ω–∞—é—Ç—Å—è –ª–∞–≤–∏–Ω—ã, –∫–æ—Ç–æ—Ä—ã–µ –≤–∞–ª—è—Ç –ø—Ä–æ–¥

---

# üîß –ü—Ä–æ–±–ª–µ–º—ã, –∫–æ—Ç–æ—Ä—ã–µ tail latency –≤—ã–∑—ã–≤–∞–µ—Ç

* üìõ **cascade timeouts**
* üìõ **retry storm**
* üìõ **—Ä–∞—Å—Ö–æ–∂–¥–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è** (–∫–æ–≥–¥–∞ –ø–æ–ª–æ–≤–∏–Ω–∞ —Ü–µ–ø–æ—á–∫–∏ –æ—Ç–≤–∞–ª–∏–ª–∞—Å—å)
* üìõ **queues backpressure**
* üìõ **–Ω–µ–ø—Ä–µ–¥—Å–∫–∞–∑—É–µ–º—ã–π UX**
* üìõ **–Ω–µ—á–µ—Å—Ç–Ω—ã–µ SLA**
* üìõ **hot spot –Ω–∞ –æ–¥–Ω–æ–º –∏–Ω—Å—Ç–∞–Ω—Å–µ**

–õ—é–±–∞—è —Ä–∞—Å–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞, —É –∫–æ—Ç–æ—Ä–æ–π –Ω–µ—Ç —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏ —Ö–≤–æ—Å—Ç–æ–≤, –æ–±—Ä–µ—á–µ–Ω–∞.

---

# üõ† –ö–∞–∫–∏–µ –µ—Å—Ç—å —Ä–µ–∞–ª—å–Ω—ã–µ —Ç–µ—Ö–Ω–∏–∫–∏ –±–æ—Ä—å–±—ã

## 1. **Hedged Requests** (–¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–æ–≤)

–ï—Å–ª–∏ –∑–∞–ø—Ä–æ—Å –≤–∏—Å–∏—Ç > X ms ‚Äî —à–ª—ë–º –≤—Ç–æ—Ä–æ–π –Ω–∞ –¥—Ä—É–≥–æ–π –∏–Ω—Å—Ç–∞–Ω—Å.
–ü–æ–±–µ–∂–¥–∞–µ—Ç –ø–µ—Ä–≤—ã–π –æ—Ç–≤–µ—Ç.

Google –ø–æ–∫–∞–∑–∞–ª, —á—Ç–æ —ç—Ç–æ —Ä–µ–∑–∫–æ —Å–Ω–∏–∂–∞–µ—Ç —Ö–≤–æ—Å—Ç—ã.

---

## 2. **Load Balancing –ø–æ latency, –∞ –Ω–µ round-robin**

–í—ã–∫–∏–¥—ã–≤–∞–µ—à—å ‚Äú–º–µ–¥–ª–µ–Ω–Ω—ã–µ‚Äù –∏–Ω—Å—Ç–∞–Ω—Å—ã –∏–∑ –ø—É–ª–∞, –ø–æ–∫–∞ –æ–Ω–∏ –Ω–µ –æ—á—É—Ö–∞—é—Ç—Å—è.

---

## 3. **Timeouts + budget propagation**

–ó–∞–ø—Ä–æ—Å –¥–æ–ª–∂–µ–Ω –∑–Ω–∞—Ç—å, —Å–∫–æ–ª—å–∫–æ –µ–º—É –æ—Å—Ç–∞–ª–æ—Å—å –∂–∏—Ç—å, –∏ –ø–µ—Ä–µ–¥–∞–≤–∞—Ç—å deadline –¥–∞–ª—å—à–µ –ø–æ —Ü–µ–ø–æ—á–∫–µ.

---

## 4. **Local L1 cache**

–ß—Ç–æ–±—ã –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å —á–∞—Å—Ç—å –∑–∞–ø—Ä–æ—Å–æ–≤ –±–µ–∑ —Å–µ—Ç–∏.

---

## 5. **Request coalescing**

–î–ª—è –ø–æ–ø—É–ª—è—Ä–Ω—ã—Ö –∫–ª—é—á–µ–π ‚Äî —Å—Ç—Ä–æ–∏—Ç –æ—á–µ—Ä–µ–¥—å –∏ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –≤ –±—ç–∫ —Ç–æ–ª—å–∫–æ –æ–¥–∏–Ω –∑–∞–ø—Ä–æ—Å.

---

## 6. **–ò–∑–æ–ª—è—Ü–∏—è –≥–æ—Ä—è—á–∏—Ö —Å–µ—Ä–≤–∏—Å–æ–≤**

–ù–∞–ø—Ä–∏–º–µ—Ä, –≤—ã–Ω–æ—Å –≤ –æ—Ç–¥–µ–ª—å–Ω—ã–π autoscaling pool.

---

## 7. **Shard-per-key**

–ö–æ–≥–¥–∞ –æ–¥–∏–Ω –≥–æ—Ä—è—á–∏–π ID –Ω–µ —Ç–æ—Ä–º–æ–∑–∏—Ç –≤–µ—Å—å shard.

---

# üß™ –î–∏–∞–≥—Ä–∞–º–º–∞ –¥–ª—è hedged requests (–≥–æ—Ç–æ–≤–∞—è –∫ –≤–∏–¥–µ–æ)

```mermaid
sequenceDiagram
    participant Client
    participant S1 as Server #1
    participant S2 as Server #2

    Client->>S1: request (t=0)
    Note over Client,S1: –∂–¥—ë–º 50ms

    alt S1 –º–µ–¥–ª–µ–Ω–Ω—ã–π
        Client->>S2: –¥—É–±–ª–∏—Ä—É—é—â–∏–π request (t=50ms)
        S2-->>Client: –±—ã—Å—Ç—Ä—ã–π –æ—Ç–≤–µ—Ç (t=80ms)
        S1-->>Client: –ø–æ–∑–¥–Ω–∏–π –æ—Ç–≤–µ—Ç (t=200ms)
    else S1 –±—ã—Å—Ç—Ä—ã–π
        S1-->>Client: –æ—Ç–≤–µ—Ç (t=20ms)
    end
```

---

# üìö –°—Å—ã–ª–∫–∏ –Ω–∞ —Ö–æ—Ä–æ—à–∏–µ –º–∞—Ç–µ—Ä–∏–∞–ª—ã

### üî• –ì–ª–∞–≤–Ω–∞—è —Å—Ç–∞—Ç—å—è:

**The Tail at Scale** (Google Research)
[https://research.google/pubs/the-tail-at-scale/](https://research.google/pubs/the-tail-at-scale/)

### –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ:

* Jeff Dean, ‚ÄúAchieving Rapid Response Times in Large Online Services‚Äù
* ACM Queue: ‚ÄúLatency Numbers Every Programmer Should Know‚Äù
* HighScalability: –æ–±–∑–æ—Ä—ã –ø–æ tail latency
* AWS Builder‚Äôs Library: ‚ÄúTimeouts, retries, and backoff with jitter‚Äù
* Papers on hedged requests (Google)
* LinkedIn‚Äôs work on queue latency & tail control

---

# üéØ –ö—Ä–∞—Ç–∫–æ–µ —Ä–µ–∑—é–º–µ –¥–ª—è —Å—Ü–µ–Ω–∞—Ä–∏—è

Tail latency ‚Äî —ç—Ç–æ:

* –Ω–µ —Å—Ä–µ–¥–Ω—è—è –∑–∞–¥–µ—Ä–∂–∫–∞
* –Ω–µ p50
* —ç—Ç–æ —Ö—É–¥—à–∏–µ 1% –∑–∞–ø—Ä–æ—Å–æ–≤
* –æ–Ω–∏ –ª–æ–º–∞—é—Ç –≤—Å—ë, —á—Ç–æ —Å–≤—è–∑–∞–Ω–æ —Å —Ä–∞—Å–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω–æ—Å—Ç—å—é
* –∏ —Ä–∞—Å—Ç—É—Ç —ç–∫—Å–ø–æ–Ω–µ–Ω—Ü–∏–∞–ª—å–Ω–æ –ø—Ä–∏ –∫–∞—Å–∫–∞–¥–µ —Å–µ—Ä–≤–∏—Å–æ–≤

> –ö–∞—Ä–∞—Ç–∏—à—å —Ö–≤–æ—Å—Ç ‚Äî —Å–ø–∞—Å–∞–µ—à—å –ø—Ä–æ–¥.
> –£–ª—É—á—à–∞–µ—à—å —Å—Ä–µ–¥–Ω–µ–µ ‚Äî —É–ª—É—á—à–∞–µ—à—å —Ç–æ–ª—å–∫–æ –≥—Ä–∞—Ñ–∏–∫–∏.

---

–ï—Å–ª–∏ —Ö–æ—á–µ—à—å ‚Äî –º–æ–≥—É:

* —Å–æ–±—Ä–∞—Ç—å —Ü–µ–ª–∏–∫–æ–º **–±–ª–æ–∫ —Å—Ü–µ–Ω–∞—Ä–∏—è** (5‚Äì7 –º–∏–Ω—É—Ç –º–∞—Ç–µ—Ä–∏–∞–ª–∞)
* –¥–æ–±–∞–≤–∏—Ç—å –µ—â—ë –¥–∏–∞–≥—Ä–∞–º–º—ã: p50 vs p99, queueing delay, retry storm
* —Ä–∞—Å–ø–∏—Å–∞—Ç—å –ø—Ä–∏–º–µ—Ä ‚Äú–∫–∞–∫ –æ–¥–∏–Ω –º–µ–¥–ª–µ–Ω–Ω—ã–π Redis –ø–æ–ª–æ–∂–∏–ª –≤—Å–µ —Å–µ—Ä–≤–∏—Å—ã‚Äù
